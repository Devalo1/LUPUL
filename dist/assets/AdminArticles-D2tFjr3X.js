import{d as e,j as t,i as a}from"./index-Bwkz9jAa.js";import{b as s,u as r}from"./vendor-ClDHXAES.js";import{q as i,s as l,K as c,t as n,u as d,N as o,T as x,U as u,X as m,S as h,V as p,W as j}from"./firebase-DUCcfN4Q.js";import{C as g,r as y,D as f,E as b,y as N,G as v,H as w}from"./index-B5L7Nnkl.js";const A=()=>{const[A,k]=s.useState([]),[S,C]=s.useState(!0),[D,U]=s.useState(null),[$,F]=s.useState(null),[z,E]=s.useState(!1),[G,I]=s.useState(null),R=r();s.useEffect((()=>{q()}),[]);const q=async()=>{C(!0);try{const t=i(e,"articles"),a=l(t,c("createdAt","desc")),s=await n(a);if(s.empty)k([]);else{const e=s.docs.map((e=>({id:e.id,...e.data()})));k(e)}}catch(t){U("A apărut o eroare la încărcarea articolelor.")}finally{C(!1)}},H=async t=>{if($)try{const s=await(async e=>{if(!$)return null;E(!0);try{const t=u(a,`articles/${e}/${$.name}`);return await p(t,$),await j(t)}catch(t){throw t}finally{E(!1)}})(t);if(s){const a=d(e,"articles",t);await o(a,{imageUrl:s,updatedAt:x.now()}),k(A.map((e=>e.id===t?{...e,imageUrl:s}:e))),F(null),I(null),alert("Imaginea a fost încărcată cu succes!")}}catch(s){alert("A apărut o eroare la încărcarea imaginii.")}else alert("Selectați o imagine mai întâi!")},K=e=>{if(!e)return"Data necunoscută";try{return(e.toDate?e.toDate():new Date(e)).toLocaleDateString("ro-RO",{year:"numeric",month:"long",day:"numeric"})}catch(t){return"Format invalid"}};return t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mt-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Gestionare Articole"}),t.jsxs("button",{onClick:()=>{R("/admin/articles/add")},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center",children:[t.jsx(g,{className:"mr-2"})," Adaugă articol nou"]})]}),D&&t.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:D}),S?t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):t.jsx("div",{className:"overflow-x-auto",children:0===A.length?t.jsx("div",{className:"text-center py-8",children:t.jsx("p",{className:"text-gray-600",children:"Nu există articole. Adăugați unul nou pentru a începe."})}):t.jsxs("table",{className:"min-w-full bg-white",children:[t.jsx("thead",{className:"bg-gray-100",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-3 px-4 text-left",children:"Articol"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Autor"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Data publicării"}),t.jsx("th",{className:"py-3 px-4 text-center",children:"Status"}),t.jsx("th",{className:"py-3 px-4 text-center",children:"Citiri"}),t.jsx("th",{className:"py-3 px-4 text-center",children:"Feedback"}),t.jsx("th",{className:"py-3 px-4 text-right",children:"Acțiuni"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:A.map((s=>{var r;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"py-4 px-4",children:t.jsxs("div",{className:"flex items-center",children:[s.imageUrl?t.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-12 h-12 rounded object-cover mr-3"}):t.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded flex items-center justify-center mr-3",children:t.jsx("span",{className:"text-gray-500 text-xs",children:"No img"})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:s.title}),s.tags&&s.tags.length>0&&t.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.tags.map(((e,a)=>t.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-800 rounded-full",children:e},a)))})]})]})}),t.jsx("td",{className:"py-4 px-4",children:t.jsx("div",{className:"text-sm text-gray-900",children:s.author})}),t.jsx("td",{className:"py-4 px-4",children:t.jsx("div",{className:"text-sm text-gray-900",children:K(s.createdAt)})}),t.jsx("td",{className:"py-4 px-4 text-center",children:t.jsx("button",{onClick:()=>(async t=>{try{const a=d(e,"articles",t.id),s=!t.published;await o(a,{published:s,updatedAt:x.now()}),k(A.map((e=>e.id===t.id?{...e,published:s}:e))),alert(`Articolul a fost ${s?"publicat":"ascuns"} cu succes!`)}catch(a){alert("A apărut o eroare la actualizarea statusului articolului.")}})(s),className:"px-2 py-1 text-xs rounded flex items-center justify-center mx-auto "+(s.published?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:s.published?t.jsxs(t.Fragment,{children:[t.jsx(y,{className:"mr-1"})," Publicat"]}):t.jsxs(t.Fragment,{children:[t.jsx(f,{className:"mr-1"})," Ascuns"]})})}),t.jsx("td",{className:"py-4 px-4 text-center",children:t.jsx("span",{className:"text-sm font-medium",children:s.readCount||0})}),t.jsx("td",{className:"py-4 px-4 text-center",children:t.jsxs("button",{onClick:()=>(e=>{e.feedback&&0!==e.feedback.length?alert(`Acest articol are ${e.feedback.length} comentarii de la utilizatori.`):alert("Acest articol nu are feedback de la utilizatori.")})(s),className:"text-blue-600 hover:text-blue-800 flex items-center justify-center mx-auto",children:[t.jsx(b,{className:"mr-1"}),t.jsx("span",{children:(null==(r=s.feedback)?void 0:r.length)||0})]})}),t.jsx("td",{className:"py-4 px-4 text-right",children:t.jsxs("div",{className:"flex justify-end space-x-2",children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"file",id:`image-upload-${s.id}`,accept:"image/*",onChange:e=>((e,t)=>{e.target.files&&e.target.files[0]&&(F(e.target.files[0]),I(t))})(e,s.id),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),t.jsx("label",{htmlFor:`image-upload-${s.id}`,className:"text-gray-600 hover:text-gray-800 cursor-pointer",title:"Încarcă imagine",children:t.jsx(N,{})})]}),G===s.id&&$&&t.jsx("button",{onClick:()=>H(s.id),disabled:z,className:"text-blue-600 hover:text-blue-800 "+(z?"opacity-50 cursor-not-allowed":""),children:z?"Se încarcă...":"Încarcă"}),t.jsx("button",{onClick:()=>{return e=s.id,void R(`/admin/articles/edit/${e}`);var e},className:"text-indigo-600 hover:text-indigo-900",title:"Editează articol",children:t.jsx(v,{})}),t.jsx("button",{onClick:()=>(async t=>{if(window.confirm("Sunteți sigur că doriți să ștergeți acest articol?"))try{const r=A.find((e=>e.id===t));if(null==r?void 0:r.imageUrl)try{const e=r.imageUrl.split("?")[0].split("/o/")[1].replace(/%2F/g,"/"),t=decodeURIComponent(e),s=u(a,t);await m(s)}catch(s){}await h(d(e,"articles",t)),k(A.filter((e=>e.id!==t))),alert("Articolul a fost șters cu succes!")}catch(r){alert("A apărut o eroare la ștergerea articolului.")}})(s.id),className:"text-red-600 hover:text-red-900",title:"Șterge articol",children:t.jsx(w,{})})]})})]},s.id)}))})]})})]})})};export{A as default};
