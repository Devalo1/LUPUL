import{d as e,j as t}from"./index-Bwkz9jAa.js";import{b as s,u as a,R as i}from"./vendor-ClDHXAES.js";import{q as r,s as n,K as d,t as l,S as c,u as x,w as m}from"./firebase-DUCcfN4Q.js";const o=()=>{const[o,h]=s.useState([]),[u,p]=s.useState({}),[j,N]=s.useState(!0),[y,g]=s.useState(null),[v,f]=s.useState(null),b=a();s.useEffect((()=>{w()}),[]);const w=async()=>{N(!0);try{const t=r(e,"events"),s=n(t,d("date","desc")),a=await l(s);if(a.empty)h([]);else{const e=a.docs.map((e=>({id:e.id,...e.data()})));h(e)}}catch(t){g("A apărut o eroare la încărcarea evenimentelor.")}finally{N(!1)}},A=e=>{if(!e)return"Data necunoscută";try{const t={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString("ro-RO",t)}catch(t){return e}},D=async t=>{v===t?f(null):(f(t),await(async t=>{try{if(u[t])return;const s=new Set,a=r(e,"eventRegistrations"),i=n(a,m("eventId","==",t)),d=await l(i),c=[];d.docs.forEach((e=>{const t=e.data();s.has(t.userId)||(s.add(t.userId),c.push({id:e.id,...t,createdAt:t.createdAt?t.createdAt.toDate?t.createdAt.toDate():t.createdAt:new Date}))}));const x=o.find((e=>e.id===t));if(x&&x.registeredUsers&&x.registeredUsers.length>0)for(const o of x.registeredUsers)if(!s.has(o)){s.add(o);const a=r(e,"users"),i=n(a,m("uid","==",o)),d=await l(i);if(d.empty)c.push({id:o,eventId:t,eventTitle:x.title,userId:o,userEmail:"",name:"Utilizator necunoscut",email:"",phone:"",additionalInfo:"",createdAt:new Date,status:"unknown"});else{const e=d.docs[0].data();c.push({id:d.docs[0].id,eventId:t,eventTitle:x.title,userId:o,userEmail:e.email||"",name:e.displayName||"Utilizator necunoscut",email:e.email||"",phone:e.phone||"",additionalInfo:"",createdAt:new Date,status:"converted"})}}p((e=>({...e,[t]:c})))}catch(s){alert("Nu s-au putut încărca înregistrările pentru acest eveniment.")}})(t))};return t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mt-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Gestionare Evenimente"}),t.jsx("button",{onClick:()=>{b("/admin/add-event")},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Adaugă eveniment nou"})]}),y&&t.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:y}),j?t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):t.jsx("div",{className:"overflow-x-auto",children:0===o.length?t.jsx("div",{className:"text-center py-8",children:t.jsx("p",{className:"text-gray-600",children:"Nu există evenimente. Adăugați unul nou pentru a începe."})}):t.jsxs("table",{className:"min-w-full bg-white",children:[t.jsx("thead",{className:"bg-gray-100",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-3 px-4 text-left",children:"Eveniment"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Data"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Locație"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Participanți"}),t.jsx("th",{className:"py-3 px-4 text-right",children:"Acțiuni"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:o.map((s=>{var a,r;return t.jsxs(i.Fragment,{children:[t.jsxs("tr",{className:"hover:bg-gray-50 "+(v===s.id?"bg-blue-50":""),children:[t.jsx("td",{className:"py-4 px-4",children:t.jsxs("div",{className:"flex items-center",children:[s.imageUrl?t.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-12 h-12 rounded object-cover mr-3"}):t.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded flex items-center justify-center mr-3",children:t.jsx("span",{className:"text-gray-500 text-xs",children:"No img"})}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:s.title}),t.jsxs("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:[null==(a=s.description)?void 0:a.substring(0,80),"..."]})]})]})}),t.jsxs("td",{className:"py-4 px-4",children:[t.jsx("div",{className:"text-sm text-gray-900",children:A(s.date)}),s.time&&t.jsx("div",{className:"text-sm text-gray-500",children:s.time})]}),t.jsx("td",{className:"py-4 px-4",children:t.jsx("div",{className:"text-sm text-gray-900",children:s.location||"Nespecificat"})}),t.jsx("td",{className:"py-4 px-4",children:t.jsxs("button",{onClick:()=>D(s.id),className:"text-sm text-blue-600 hover:text-blue-800",children:[(null==(r=s.registeredUsers)?void 0:r.length)||0," / ",s.capacity||"∞",v===s.id?" ▲":" ▼"]})}),t.jsxs("td",{className:"py-4 px-4 text-right space-x-2",children:[t.jsx("button",{onClick:()=>{return e=s.id,void b(`/admin/events/edit/${e}`);var e},className:"text-indigo-600 hover:text-indigo-900",children:"Editează"}),t.jsx("button",{onClick:()=>(async t=>{if(window.confirm("Sunteți sigur că doriți să ștergeți acest eveniment?"))try{await c(x(e,"events",t)),h(o.filter((e=>e.id!==t))),alert("Evenimentul a fost șters cu succes!")}catch(s){alert("A apărut o eroare la ștergerea evenimentului.")}})(s.id),className:"text-red-600 hover:text-red-900 ml-3",children:"Șterge"})]})]}),v===s.id&&t.jsx("tr",{children:t.jsx("td",{colSpan:5,className:"bg-gray-50 px-4 py-4",children:t.jsxs("div",{className:"border rounded-md p-4",children:[t.jsx("h3",{className:"font-medium text-lg mb-4",children:"Lista de participanți"}),u[s.id]?0===u[s.id].length?t.jsx("p",{className:"text-gray-500 italic",children:"Niciun participant înregistrat pentru acest eveniment."}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full bg-white border",children:[t.jsx("thead",{className:"bg-gray-100",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-2 px-3 text-left",children:"Nume"}),t.jsx("th",{className:"py-2 px-3 text-left",children:"Email"}),t.jsx("th",{className:"py-2 px-3 text-left",children:"Telefon"}),t.jsx("th",{className:"py-2 px-3 text-left",children:"Informații adiționale"}),t.jsx("th",{className:"py-2 px-3 text-left",children:"Data înregistrării"})]})}),t.jsx("tbody",{children:u[s.id].map((e=>t.jsxs("tr",{className:"border-t",children:[t.jsx("td",{className:"py-2 px-3",children:e.name}),t.jsx("td",{className:"py-2 px-3",children:e.email}),t.jsx("td",{className:"py-2 px-3",children:e.phone}),t.jsx("td",{className:"py-2 px-3",children:e.additionalInfo||"-"}),t.jsx("td",{className:"py-2 px-3",children:e.createdAt?new Date(e.createdAt).toLocaleString("ro-RO"):"-"})]},e.id)))})]})}):t.jsx("div",{className:"flex justify-center items-center h-16",children:t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-blue-500"})})]})})})]},s.id)}))})]})})]})})};export{o as default};
