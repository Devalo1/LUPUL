import{d as e,j as t}from"./index-wFNFqtXh.js";import{b as s}from"./vendor-BbhD7xee.js";import{s as a,q as r,K as l,t as c,u as i,N as d,T as o,M as n,w as m}from"./firebase-Bc5mL6iy.js";import{u as x}from"./useCategories-M_Cuz4PI.js";const u=()=>{const[u,h]=s.useState([]),[g,p]=s.useState([]),[b,j]=s.useState(null),[f,y]=s.useState(!0),[N,v]=s.useState(!1),[w,k]=s.useState(!1),[S,C]=s.useState(!1),[U,A]=s.useState(""),[L,z]=s.useState("all"),[F,I]=s.useState("name"),[P,K]=s.useState("asc"),[M,D]=s.useState(!1),[B,O]=s.useState(0),[E,R]=s.useState(""),{categories:V,formatCategoryName:T}=x();s.useEffect((()=>{H()}),[]);const H=async()=>{try{y(!0);const t=a(r(e,"products"),l("name")),s=(await c(t)).docs.map((e=>{const t=e.data();return{id:e.id,name:t.name||"",description:t.description||"",price:t.price||0,category:t.category||"diverse",stock:t.stock||0,sku:t.sku||"",lastUpdated:t.lastUpdated||null,image:t.image||t.imageUrl||"",imageUrl:t.imageUrl||t.image||"",inStock:void 0!==t.inStock?t.inStock:t.stock>0,lowStockAlert:t.lowStockAlert||5,costPrice:t.costPrice||0,supplier:t.supplier||""}}));h(s)}catch(t){alert("Eroare la încărcarea produselor. Vă rugăm încercați din nou.")}finally{y(!1)}},W=async t=>{j(t),C(!0),await(async t=>{try{v(!0);const s=a(r(e,"stockHistory"),m("productId","==",t),l("timestamp","desc")),i=(await c(s)).docs.map((e=>({id:e.id,...e.data()})));p(i)}catch(s){alert("Eroare la încărcarea istoricului stocului. Vă rugăm încercați din nou.")}finally{v(!1)}})(t.id)},q=e=>{if(!e)return"Nedefinit";try{return(e.toDate?e.toDate():new Date(e)).toLocaleString("ro-RO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return"Format invalid"}},G=e=>new Intl.NumberFormat("ro-RO",{style:"currency",currency:"RON",minimumFractionDigits:2}).format(e),J=u.filter((e=>{var t,s,a;const r=(null==(t=e.name)?void 0:t.toLowerCase().includes(U.toLowerCase()))||(null==(s=e.description)?void 0:s.toLowerCase().includes(U.toLowerCase()))||!1||(null==(a=e.sku)?void 0:a.toLowerCase().includes(U.toLowerCase()))||!1,l="all"===L||e.category===L,c=!M||(e.stock??0)<=(e.lowStockAlert||5);return r&&l&&c})).sort(((e,t)=>{var s,a;let r=0;switch(F){case"name":r=e.name.localeCompare(t.name);break;case"price":r=e.price-t.price;break;case"stock":r=(e.stock??0)-(t.stock??0);break;case"category":const l="string"==typeof e.category?e.category:(null==(s=e.category)?void 0:s.name)||"",c="string"==typeof t.category?t.category:(null==(a=t.category)?void 0:a.name)||"";r=l.localeCompare(c);break;case"lastUpdated":r=e.lastUpdated&&t.lastUpdated?e.lastUpdated.seconds-t.lastUpdated.seconds:0;break;default:r=0}return"asc"===P?r:-r})),Q=u.length,X=u.reduce(((e,t)=>e+t.price*(t.stock??0)),0),Y=u.reduce(((e,t)=>e+(t.stock??0)),0),Z=u.filter((e=>(e.stock??0)<=(e.lowStockAlert||5))).length;return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[t.jsx("h2",{className:"text-xl font-bold mb-6",children:"Gestionare Stocuri"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 flex flex-col",children:[t.jsx("span",{className:"text-sm text-blue-600 font-medium",children:"Total produse"}),t.jsx("span",{className:"text-2xl font-bold",children:Q})]}),t.jsxs("div",{className:"bg-green-50 rounded-lg p-4 flex flex-col",children:[t.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Valoare totală stoc"}),t.jsx("span",{className:"text-2xl font-bold",children:G(X)})]}),t.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 flex flex-col",children:[t.jsx("span",{className:"text-sm text-purple-600 font-medium",children:"Total unități în stoc"}),t.jsx("span",{className:"text-2xl font-bold",children:Y})]}),t.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 flex flex-col",children:[t.jsx("span",{className:"text-sm text-yellow-600 font-medium",children:"Produse cu stoc scăzut"}),t.jsx("span",{className:"text-2xl font-bold",children:Z})]})]}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-1",children:"Caută produs"}),t.jsx("input",{type:"text",id:"search",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Nume, descriere sau SKU...",value:U,onChange:e=>A(e.target.value)})]}),t.jsxs("div",{className:"w-full md:w-48",children:[t.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 mb-1",children:"Categorie"}),t.jsxs("select",{id:"category",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:L,onChange:e=>z(e.target.value),children:[t.jsx("option",{value:"all",children:"Toate categoriile"}),V.map((e=>t.jsx("option",{value:e.slug,children:e.name},e.id)))]})]}),t.jsxs("div",{className:"w-full md:w-48",children:[t.jsx("label",{htmlFor:"sortBy",className:"block text-sm font-medium text-gray-700 mb-1",children:"Sortează după"}),t.jsxs("select",{id:"sortBy",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:F,onChange:e=>I(e.target.value),children:[t.jsx("option",{value:"name",children:"Nume"}),t.jsx("option",{value:"price",children:"Preț"}),t.jsx("option",{value:"stock",children:"Stoc"}),t.jsx("option",{value:"category",children:"Categorie"}),t.jsx("option",{value:"lastUpdated",children:"Ultima actualizare"})]})]}),t.jsxs("div",{className:"w-full md:w-48",children:[t.jsx("label",{htmlFor:"sortOrder",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordine"}),t.jsxs("select",{id:"sortOrder",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:P,onChange:e=>K(e.target.value),children:[t.jsx("option",{value:"asc",children:"Crescător"}),t.jsx("option",{value:"desc",children:"Descrescător"})]})]}),t.jsx("div",{className:"w-full md:w-48 flex items-end",children:t.jsxs("label",{className:"inline-flex items-center",children:[t.jsx("input",{type:"checkbox",className:"form-checkbox h-5 w-5 text-blue-600",checked:M,onChange:e=>D(e.target.checked)}),t.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Doar stoc scăzut"})]})})]}),f?t.jsx("div",{className:"flex justify-center items-center h-48",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Produs"}),t.jsx("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"SKU / Categorie"}),t.jsx("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Preț"}),t.jsx("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Stoc"}),t.jsx("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Ultima actualizare"}),t.jsx("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Acțiuni"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:J.length>0?J.map((e=>{var s;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"py-4 px-4",children:t.jsxs("div",{className:"flex items-center",children:[e.imageUrl||e.image?t.jsx("img",{src:e.imageUrl||e.image,alt:e.name,className:"h-10 w-10 rounded object-cover mr-3"}):t.jsx("div",{className:"h-10 w-10 rounded bg-gray-100 flex items-center justify-center mr-3",children:t.jsx("span",{className:"text-xs text-gray-500",children:"No img"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),t.jsx("div",{className:"text-xs text-gray-500 max-w-xs truncate",children:e.description})]})]})}),t.jsxs("td",{className:"py-4 px-4",children:[t.jsx("div",{className:"text-sm text-gray-900",children:e.sku||"Fără SKU"}),t.jsx("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:"string"==typeof e.category?T(e.category):(null==(s=e.category)?void 0:s.name)||"Necategorizat"})]}),t.jsxs("td",{className:"py-4 px-4",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:G(e.price)}),e.costPrice&&t.jsxs("div",{className:"text-xs text-gray-500",children:["Cost: ",G(e.costPrice)]})]}),t.jsxs("td",{className:"py-4 px-4",children:[t.jsxs("div",{className:"text-sm font-medium "+((e.stock??0)<=(e.lowStockAlert||5)?"text-red-600":"text-green-600"),children:[e.stock??0," buc"]}),e.lowStockAlert&&t.jsxs("div",{className:"text-xs text-gray-500",children:["Alertă la: ",e.lowStockAlert," buc"]})]}),t.jsx("td",{className:"py-4 px-4",children:t.jsx("div",{className:"text-sm text-gray-900",children:e.lastUpdated?q(e.lastUpdated):"Necunoscut"})}),t.jsxs("td",{className:"py-4 px-4 whitespace-nowrap",children:[t.jsx("button",{onClick:()=>(e=>{j(e),O(0),R(""),k(!0)})(e),className:"text-indigo-600 hover:text-indigo-900 mr-3",children:"Ajustează stoc"}),t.jsx("button",{onClick:()=>W(e),className:"text-blue-600 hover:text-blue-900",children:"Istoric"})]})]},e.id)})):t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"py-4 px-4 text-center text-gray-500",children:"Nu s-au găsit produse care să corespundă criteriilor selectate."})})})]})})]}),w&&b&&t.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex justify-center items-center",children:t.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg w-full max-w-md mx-4 p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-medium",children:"Ajustare Stoc"}),t.jsx("button",{onClick:()=>{k(!1),j(null)},className:"text-gray-400 hover:text-gray-500",children:t.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[b.imageUrl||b.image?t.jsx("img",{src:b.imageUrl||b.image,alt:b.name,className:"h-16 w-16 rounded object-cover mr-3"}):t.jsx("div",{className:"h-16 w-16 rounded bg-gray-100 flex items-center justify-center mr-3",children:t.jsx("span",{className:"text-xs text-gray-500",children:"No img"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-lg font-medium text-gray-900",children:b.name}),t.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",b.sku||"Fără SKU"]})]})]}),t.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Stoc curent"}),t.jsx("div",{className:"mt-1 text-2xl font-bold",children:b.stock??0})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Preț de vânzare"}),t.jsx("div",{className:"mt-1 text-xl font-medium",children:G(b.price)})]})]})}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"stockAdjustment",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ajustare stoc (+ pentru adăugare, - pentru retragere)"}),t.jsx("input",{type:"number",id:"stockAdjustment",value:B,onChange:e=>O(parseInt(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"adjustmentReason",className:"block text-sm font-medium text-gray-700 mb-1",children:"Motiv pentru ajustare"}),t.jsx("textarea",{id:"adjustmentReason",value:E,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"Introduceți motivul ajustării stocului..."})]}),t.jsx("div",{className:"bg-blue-50 rounded-lg p-4 mb-4",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Stoc după ajustare:"}),t.jsx("span",{className:"text-lg font-bold "+((b.stock??0)+B<=(b.lowStockAlert||5)?"text-red-600":"text-green-600"),children:(b.stock??0)+B})]})}),t.jsx("button",{onClick:async()=>{if(b)if(E.trim())try{const t=b.stock||0,s=t+B;if(s<0)return void alert("Stocul nu poate fi negativ.");const a=i(e,"products",b.id);await d(a,{stock:s,inStock:s>0,lastUpdated:o.now()}),await n(r(e,"stockHistory"),{productId:b.id,productName:b.name,previousStock:t,newStock:s,changedBy:"admin@example.com",action:B>0?"add":"remove",reason:E,timestamp:o.now()}),h(u.map((e=>e.id===b.id?{...e,stock:s,inStock:s>0,lastUpdated:o.now()}:e))),k(!1),O(0),R(""),alert("Stocul a fost actualizat cu succes!")}catch(t){alert("Eroare la ajustarea stocului. Vă rugăm încercați din nou.")}else alert("Vă rugăm introduceți un motiv pentru ajustarea stocului.")},className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:0===B,children:"Salvează modificarea"})]})]})}),S&&b&&t.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex justify-center items-center",children:t.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg w-full max-w-3xl mx-4 p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-medium",children:"Istoric Stoc"}),t.jsx("button",{onClick:()=>{C(!1),j(null),p([])},className:"text-gray-400 hover:text-gray-500",children:t.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("h4",{className:"font-medium text-lg mb-1",children:b.name}),t.jsxs("p",{className:"text-sm text-gray-500",children:["SKU: ",b.sku||"Fără SKU"]})]}),N?t.jsx("div",{className:"flex justify-center items-center h-48",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Data"}),t.jsx("th",{className:"py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Acțiune"}),t.jsx("th",{className:"py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Stoc anterior"}),t.jsx("th",{className:"py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Stoc nou"}),t.jsx("th",{className:"py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Modificat de"}),t.jsx("th",{className:"py-2 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Motiv"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:g.length>0?g.map((e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"py-3 px-4 text-sm text-gray-500",children:q(e.timestamp)}),t.jsx("td",{className:"py-3 px-4",children:t.jsx("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full "+("add"===e.action?"bg-green-100 text-green-800":"remove"===e.action?"bg-red-100 text-red-800":"order"===e.action?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"),children:"add"===e.action?"Adăugare":"remove"===e.action?"Eliminare":"order"===e.action?"Comandă":"Ajustare"})}),t.jsx("td",{className:"py-3 px-4 text-sm text-gray-900",children:e.previousStock}),t.jsx("td",{className:"py-3 px-4 text-sm text-gray-900",children:e.newStock}),t.jsx("td",{className:"py-3 px-4 text-sm text-gray-500",children:e.changedBy}),t.jsxs("td",{className:"py-3 px-4 text-sm text-gray-500 max-w-xs truncate",children:[e.reason||"—",e.orderId&&t.jsxs("span",{className:"ml-1 text-xs text-blue-600",children:["(Comandă #",e.orderId.substring(0,6),")"]})]})]},e.id))):t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"py-4 px-4 text-center text-gray-500",children:"Nu există înregistrări în istoricul stocului pentru acest produs."})})})]})})]})})]})};export{u as default};
