import{d as e,j as t}from"./index-Bwkz9jAa.js";import{b as a}from"./vendor-ClDHXAES.js";import{s,q as r,K as l,w as n,t as d,u as i,N as c,T as o}from"./firebase-DUCcfN4Q.js";const x=()=>{const[x,m]=a.useState([]),[u,p]=a.useState(!0),[h,g]=a.useState(null),[b,y]=a.useState("all"),[j,N]=a.useState(""),[v,f]=a.useState(null),[w,C]=a.useState(!1),[k,S]=a.useState(""),[z,A]=a.useState(""),[D,L]=a.useState("");a.useEffect((()=>{E()}),[b]);const E=async()=>{p(!0);try{let t;t="all"===b?s(r(e,"orders"),l("orderDate","desc")):s(r(e,"orders"),n("status","==",b),l("orderDate","desc"));const a=await d(t);if(a.empty)m([]);else{const e=a.docs.map((e=>({id:e.id,...e.data()})));m(e)}}catch(t){g("A apărut o eroare la încărcarea comenzilor.")}finally{p(!1)}},O=e=>{if(!e)return"Data necunoscută";try{return(e.toDate?e.toDate():new Date(e)).toLocaleDateString("ro-RO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return"Format invalid"}},R=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"shipped":return"bg-purple-100 text-purple-800";case"delivered":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},T=x.filter((e=>{if(!j.trim())return!0;const t=j.toLowerCase();return e.id.toLowerCase().includes(t)||e.name.toLowerCase().includes(t)||e.email.toLowerCase().includes(t)||e.phone.toLowerCase().includes(t)||e.address.toLowerCase().includes(t)}));return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mt-6",children:[t.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Gestionare Comenzi"}),h&&t.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:h}),t.jsxs("div",{className:"flex flex-col md:flex-row justify-between mb-6 space-y-3 md:space-y-0",children:[t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:()=>y("all"),className:"px-4 py-2 rounded-md "+("all"===b?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"),children:"Toate comenzile"}),t.jsx("button",{onClick:()=>y("pending"),className:"px-4 py-2 rounded-md "+("pending"===b?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"),children:"În așteptare"}),t.jsx("button",{onClick:()=>y("processing"),className:"px-4 py-2 rounded-md "+("processing"===b?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"),children:"În procesare"}),t.jsx("button",{onClick:()=>y("shipped"),className:"px-4 py-2 rounded-md "+("shipped"===b?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"),children:"Expediate"})]}),t.jsx("div",{className:"w-full md:w-64",children:t.jsx("input",{type:"text",placeholder:"Caută după nume, email, telefon...",className:"w-full px-4 py-2 border border-gray-300 rounded-md",value:j,onChange:e=>N(e.target.value)})})]}),u?t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):0===T.length?t.jsx("div",{className:"text-center py-8",children:t.jsx("p",{className:"text-gray-600",children:"Nu s-au găsit comenzi pentru filtrele selectate."})}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full bg-white",children:[t.jsx("thead",{className:"bg-gray-100",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-3 px-4 text-left",children:"Comandă"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Client"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Data"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Total"}),t.jsx("th",{className:"py-3 px-4 text-center",children:"Status"}),t.jsx("th",{className:"py-3 px-4 text-right",children:"Acțiuni"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:T.map((e=>{return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsxs("td",{className:"py-4 px-4",children:[t.jsxs("div",{className:"font-medium text-gray-900",children:["#",e.id.slice(0,8)]}),t.jsxs("div",{className:"text-xs text-gray-500",children:[e.items.length," produs(e)"]})]}),t.jsxs("td",{className:"py-4 px-4",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),t.jsx("div",{className:"text-xs text-gray-500",children:e.email}),t.jsx("div",{className:"text-xs text-gray-500",children:e.phone})]}),t.jsx("td",{className:"py-4 px-4",children:t.jsx("div",{className:"text-sm text-gray-900",children:O(e.orderDate)})}),t.jsx("td",{className:"py-4 px-4",children:t.jsx("div",{className:"text-sm font-medium text-gray-900",children:(s=e.totalAmount,new Intl.NumberFormat("ro-RO",{style:"currency",currency:"RON"}).format(s))})}),t.jsx("td",{className:"py-4 px-4 text-center",children:t.jsx("span",{className:`inline-block px-2 py-1 text-xs rounded ${R(e.status)}`,children:(a=e.status,{pending:"În așteptare",processing:"În procesare",shipped:"Expediat",delivered:"Livrat",cancelled:"Anulat"}[a]||a)})}),t.jsx("td",{className:"py-4 px-4 text-right",children:t.jsx("button",{onClick:()=>(e=>{f(e),S(e.status),A(e.trackingNumber||""),L(e.notes||""),C(!0)})(e),className:"text-indigo-600 hover:text-indigo-900",children:"Actualizează"})})]},e.id);var a,s}))})]})})]}),w&&v&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[t.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Actualizare Comandă #",v.id.slice(0,8)]}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:["Client: ",v.name]}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Email: ",v.email]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status Comandă"}),t.jsxs("select",{value:k,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[t.jsx("option",{value:"pending",children:"În așteptare"}),t.jsx("option",{value:"processing",children:"În procesare"}),t.jsx("option",{value:"shipped",children:"Expediat"}),t.jsx("option",{value:"delivered",children:"Livrat"}),t.jsx("option",{value:"cancelled",children:"Anulat"})]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Număr AWB (opțional)"}),t.jsx("input",{type:"text",value:z,onChange:e=>A(e.target.value),placeholder:"Introduceți numărul AWB",className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Note (opțional)"}),t.jsx("textarea",{value:D,onChange:e=>L(e.target.value),placeholder:"Adăugați note despre comandă",className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:3})]}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{onClick:()=>C(!1),className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-100",children:"Anulează"}),t.jsx("button",{onClick:async()=>{if(v)try{const t=i(e,"orders",v.id);await c(t,{status:k,trackingNumber:z.trim()||v.trackingNumber||"",notes:D.trim()||v.notes||"",updatedAt:o.now()}),m(x.map((e=>e.id===v.id?{...e,status:k,trackingNumber:z.trim()||e.trackingNumber,notes:D.trim()||e.notes}:e))),C(!1),f(null),alert("Comanda a fost actualizată cu succes!")}catch(t){alert("A apărut o eroare la actualizarea comenzii.")}},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Salvează"})]})]})})]})};export{x as default};
