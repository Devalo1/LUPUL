import{d as e,j as t}from"./index-Bwkz9jAa.js";import{b as s}from"./vendor-ClDHXAES.js";import{s as a,q as r,K as l,t as i,A as n,u as d,x as o,T as c}from"./firebase-DUCcfN4Q.js";const m=()=>{const[m,x]=s.useState([]),[u,p]=s.useState(!0),[h,g]=s.useState(""),[f,b]=s.useState("all"),[j,N]=s.useState("lastLogin"),[y,v]=s.useState("desc"),[w,A]=s.useState(null),[k,z]=s.useState(!1);s.useEffect((()=>{C()}),[]);const C=async()=>{try{p(!0);const t=a(r(e,"users"),l("createdAt","desc")),s=await i(t),o=a(r(e,"orders")),c=await i(o),m={};c.docs.forEach((e=>{const t=e.data().userId;t&&(m[t]=(m[t]||0)+1)}));const u=a(r(e,"appointments")),h=await i(u),g={};h.docs.forEach((e=>{const t=e.data().userId;t&&(g[t]=(g[t]||0)+1)}));const f=a(r(e,"roles")),b=await i(f),j={};b.docs.forEach((e=>{j[e.id]=e.data().role||""}));const N=await Promise.all(s.docs.map((async t=>{const s=t.data();let a=!1;try{a=(await n(d(e,"admin",t.id))).exists()}catch(r){}return{id:t.id,email:s.email||"",displayName:s.displayName||"",phoneNumber:s.phoneNumber||"",createdAt:s.createdAt||null,lastLogin:s.lastLoginAt||null,role:j[t.id]||(a?"admin":"user"),isAdmin:a,orders:m[t.id]||0,appointments:g[t.id]||0}})));x(N)}catch(t){alert("Eroare la încărcarea utilizatorilor. Vă rugăm încercați din nou.")}finally{p(!1)}},L=async t=>{try{await o(d(e,"admin",t),{role:"admin",addedAt:c.now()}),x(m.map((e=>e.id===t?{...e,isAdmin:!0,role:"admin"}:e))),alert("Utilizatorul a fost promovat la rolul de Admin.")}catch(s){alert("Eroare la adăugarea utilizatorului ca admin. Vă rugăm încercați din nou.")}},U=async t=>{try{await o(d(e,"admin",t),{}),x(m.map((e=>e.id===t?{...e,isAdmin:!1,role:"user"}:e))),alert("Rolul de admin a fost revocat pentru acest utilizator.")}catch(s){alert("Eroare la revocarea rolului de admin. Vă rugăm încercați din nou.")}},D=()=>{z(!1),A(null)},S=m.filter((e=>{var t,s,a;const r=(null==(t=e.email)?void 0:t.toLowerCase().includes(h.toLowerCase()))||(null==(s=e.displayName)?void 0:s.toLowerCase().includes(h.toLowerCase()))||!1||(null==(a=e.phoneNumber)?void 0:a.toLowerCase().includes(h.toLowerCase()))||!1;switch(f){case"admin":return r&&e.isAdmin;case"regular":return r&&!e.isAdmin;default:return r}})).sort(((e,t)=>{let s=0;switch(j){case"email":s=e.email.localeCompare(t.email);break;case"name":s=(e.displayName||"").localeCompare(t.displayName||"");break;case"createdAt":s=e.createdAt&&t.createdAt?e.createdAt.seconds-t.createdAt.seconds:0;break;case"lastLogin":s=e.lastLogin&&t.lastLogin?e.lastLogin.seconds-t.lastLogin.seconds:0;break;case"orders":s=(e.orders||0)-(t.orders||0);break;case"appointments":s=(e.appointments||0)-(t.appointments||0);break;default:s=0}return"asc"===y?s:-s})),E=e=>{if(!e)return"Necunoscut";try{return new Date(1e3*e.seconds).toLocaleDateString("ro-RO",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return"Data invalidă"}};return t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"Gestionare Utilizatori"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 flex flex-col",children:[t.jsx("span",{className:"text-sm text-blue-600 font-medium",children:"Total utilizatori"}),t.jsx("span",{className:"text-2xl font-bold",children:m.length})]}),t.jsxs("div",{className:"bg-green-50 rounded-lg p-4 flex flex-col",children:[t.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Activi (ultima lună)"}),t.jsx("span",{className:"text-2xl font-bold",children:m.filter((e=>e.lastLogin&&Date.now()-1e3*e.lastLogin.seconds<2592e6)).length})]}),t.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 flex flex-col",children:[t.jsx("span",{className:"text-sm text-purple-600 font-medium",children:"Administratori"}),t.jsx("span",{className:"text-2xl font-bold",children:m.filter((e=>e.isAdmin)).length})]}),t.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 flex flex-col",children:[t.jsx("span",{className:"text-sm text-yellow-600 font-medium",children:"Utilizatori regulari"}),t.jsx("span",{className:"text-2xl font-bold",children:m.filter((e=>!e.isAdmin)).length})]})]}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-1",children:"Caută utilizator"}),t.jsx("input",{type:"text",id:"search",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Email, nume sau telefon...",value:h,onChange:e=>g(e.target.value)})]}),t.jsxs("div",{className:"w-full md:w-48",children:[t.jsx("label",{htmlFor:"filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Filtru"}),t.jsxs("select",{id:"filter",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:f,onChange:e=>b(e.target.value),children:[t.jsx("option",{value:"all",children:"Toți utilizatorii"}),t.jsx("option",{value:"admin",children:"Doar administratori"}),t.jsx("option",{value:"regular",children:"Doar utilizatori regulari"})]})]}),t.jsxs("div",{className:"w-full md:w-48",children:[t.jsx("label",{htmlFor:"sortBy",className:"block text-sm font-medium text-gray-700 mb-1",children:"Sortează după"}),t.jsxs("select",{id:"sortBy",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:j,onChange:e=>N(e.target.value),children:[t.jsx("option",{value:"email",children:"Email"}),t.jsx("option",{value:"name",children:"Nume"}),t.jsx("option",{value:"lastLogin",children:"Ultima conectare"}),t.jsx("option",{value:"createdAt",children:"Data înregistrării"}),t.jsx("option",{value:"orders",children:"Comenzi"}),t.jsx("option",{value:"appointments",children:"Programări"})]})]}),t.jsxs("div",{className:"w-full md:w-48",children:[t.jsx("label",{htmlFor:"sortOrder",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ordine"}),t.jsxs("select",{id:"sortOrder",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:y,onChange:e=>v(e.target.value),children:[t.jsx("option",{value:"asc",children:"Crescător"}),t.jsx("option",{value:"desc",children:"Descrescător"})]})]})]}),u?t.jsx("div",{className:"flex justify-center items-center h-48",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full bg-white border border-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Utilizator"}),t.jsx("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Dată înregistrare"}),t.jsx("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Ultima conectare"}),t.jsx("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Rol"}),t.jsx("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Comenzi / Programări"}),t.jsx("th",{className:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"Acțiuni"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:S.length>0?S.map((e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"py-4 px-4",children:t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.displayName||"Utilizator necunoscut"}),t.jsx("div",{className:"text-sm text-gray-500",children:e.email}),e.phoneNumber&&t.jsx("div",{className:"text-sm text-gray-500",children:e.phoneNumber}),t.jsxs("div",{className:"text-xs text-gray-400",children:["ID: ",e.id]})]})}),t.jsx("td",{className:"py-4 px-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:E(e.createdAt)})}),t.jsx("td",{className:"py-4 px-4 whitespace-nowrap",children:t.jsx("div",{className:"text-sm text-gray-900",children:E(e.lastLogin)})}),t.jsx("td",{className:"py-4 px-4 whitespace-nowrap",children:t.jsx("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full "+(e.isAdmin?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"),children:e.isAdmin?"Administrator":"Utilizator"})}),t.jsx("td",{className:"py-4 px-4 whitespace-nowrap",children:t.jsxs("div",{className:"text-sm text-gray-500",children:[t.jsx("span",{className:"font-medium text-gray-800",children:e.orders})," comenzi /",t.jsxs("span",{className:"font-medium text-gray-800",children:[" ",e.appointments]})," programări"]})}),t.jsxs("td",{className:"py-4 px-4 whitespace-nowrap",children:[t.jsx("button",{className:"text-blue-600 hover:text-blue-900 mr-3",onClick:()=>(e=>{A(e),z(!0)})(e),children:"Detalii"}),e.isAdmin?t.jsx("button",{className:"text-red-600 hover:text-red-900",onClick:()=>{confirm("Sunteți sigur că doriți să revocați rolul de administrator pentru acest utilizator?")&&U(e.id)},children:"Revocă Admin"}):t.jsx("button",{className:"text-purple-600 hover:text-purple-900",onClick:()=>L(e.id),children:"Adaugă ca Admin"})]})]},e.id))):t.jsx("tr",{children:t.jsx("td",{colSpan:6,className:"py-4 px-4 text-center text-gray-500",children:"Nu s-au găsit utilizatori care să corespundă criteriilor selectate."})})})]})})]}),k&&w&&t.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex justify-center items-center",children:t.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg w-full max-w-md mx-4 p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-medium",children:"Detalii Utilizator"}),t.jsx("button",{onClick:D,className:"text-gray-400 hover:text-gray-500",children:t.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"text-center mb-4",children:[t.jsx("div",{className:"h-20 w-20 rounded-full bg-gray-200 flex items-center justify-center mx-auto mb-2",children:t.jsx("span",{className:"text-2xl font-bold text-gray-500",children:w.displayName?w.displayName.substring(0,2).toUpperCase():w.email.substring(0,2).toUpperCase()})}),t.jsx("h4",{className:"text-lg font-medium",children:w.displayName||"Utilizator necunoscut"}),t.jsx("p",{className:"text-sm text-gray-500",children:w.email}),t.jsx("div",{className:"inline-block mt-1 px-2 py-1 text-xs leading-5 font-semibold rounded-full "+(w.isAdmin?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"),children:w.isAdmin?"Administrator":"Utilizator"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-500",children:"ID Utilizator"}),t.jsx("p",{className:"mt-1 text-sm text-gray-800 break-all",children:w.id})]}),w.phoneNumber&&t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Telefon"}),t.jsx("p",{className:"mt-1 text-sm text-gray-800",children:w.phoneNumber})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Data înregistrării"}),t.jsx("p",{className:"mt-1 text-sm text-gray-800",children:E(w.createdAt)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Ultima conectare"}),t.jsx("p",{className:"mt-1 text-sm text-gray-800",children:E(w.lastLogin)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Comenzi"}),t.jsx("p",{className:"mt-1 text-sm text-gray-800",children:w.orders||0})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Programări"}),t.jsx("p",{className:"mt-1 text-sm text-gray-800",children:w.appointments||0})]})]}),t.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[t.jsx("h5",{className:"text-sm font-medium text-gray-500 mb-2",children:"Acțiuni"}),w.isAdmin?t.jsx("button",{onClick:()=>{confirm("Sunteți sigur că doriți să revocați rolul de administrator pentru acest utilizator?")&&(U(w.id),D())},className:"w-full px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",children:"Revocă drepturi de Administrator"}):t.jsx("button",{onClick:()=>{L(w.id),D()},className:"w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500",children:"Adaugă ca Administrator"})]})]})]})})]})};export{m as default};
