import{a as e,j as a,d as t,i as r}from"./index-Bwkz9jAa.js";import{f as s,u as l,b as i}from"./vendor-ClDHXAES.js";import{u as n,A as o,T as d,q as c,M as m,N as u,U as g,V as x,W as b,X as h}from"./firebase-DUCcfN4Q.js";import"./ThemeContext-DrZ0fxr9.js";import{I as p,m as y,o as f,C as j,J as v,y as N,H as w,r as C,D as S,K as U,L as k}from"./index-B5L7Nnkl.js";const A=()=>{var A;const{id:I}=s(),F=l(),{user:z}=e(),D=!I,[T,L]=i.useState({title:"",content:"",author:"",imageUrl:"",published:!0,tags:[],preview:"",readCount:0,readBy:[],feedback:[],galleryImages:[],coverStyle:"standard"}),[$,E]=i.useState(!0),[R,O]=i.useState(null),[q,B]=i.useState(!1),[G,V]=i.useState(""),[K,M]=i.useState(null),[P,_]=i.useState(null),[H,J]=i.useState(""),[W,X]=i.useState(!1),[Q,Y]=i.useState(!0),[Z,ee]=i.useState([]),[ae,te]=i.useState([]),[re,se]=i.useState(!1),[le,ie]=i.useState(!1);i.useEffect((()=>{(async()=>{if(D)E(!1);else try{if(!I)return void O("ID-ul articolului lipsește.");const e=n(t,"articles",I),a=await o(e);if(a.exists()){const e=a.data();L({id:I,...e}),e.imageUrl&&J(e.imageUrl),e.galleryImages&&e.galleryImages.length>0&&te(e.galleryImages)}else O("Articolul nu a fost găsit.")}catch(e){O("A apărut o eroare la încărcarea articolului.")}finally{E(!1)}})()}),[I,D]);const ne=e=>{const{name:a,value:t}=e.target;L((e=>{if("content"===a&&Q){const r=t.substring(0,150)+(t.length>150?"...":"");return{...e,[a]:t,preview:r}}return"preview"===a?(Y(!1),{...e,[a]:t}):{...e,[a]:t}}))},oe=()=>{var e;G.trim()&&!(null==(e=T.tags)?void 0:e.includes(G.trim()))&&(L((e=>({...e,tags:[...e.tags||[],G.trim()]}))),V(""))},de=e=>{L((a=>({...a,coverStyle:e})))},ce=()=>(new Date).toLocaleDateString("ro-RO",{year:"numeric",month:"long",day:"numeric"});return $?a.jsx("div",{className:"flex justify-center items-center h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):a.jsx("div",{className:"container mx-auto px-4 py-8",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 border border-gray-200",children:[a.jsx("h1",{className:"text-3xl font-bold mb-8 text-gray-800 border-b pb-4",children:D?"Adaugă Articol Nou":"Editare Articol"}),R&&a.jsx("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded shadow-md",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(p,{className:"text-red-500 mr-2"}),a.jsx("p",{children:R})]})}),q&&a.jsx("div",{className:"bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded shadow-md",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(y,{className:"text-green-500 mr-2"}),a.jsxs("p",{children:["Articolul a fost ",D?"creat":"actualizat"," cu succes!"]})]})}),a.jsxs("form",{onSubmit:async e=>{var a;e.preventDefault(),O(null),B(!1);try{if(!T.title||!T.content)return void O("Titlul și conținutul sunt obligatorii.");let e=T.imageUrl||"";if(K)try{e=await(async()=>{if(!K)return T.imageUrl||"";X(!0),_(0);try{const e=`articles/${(new Date).getTime()}_${K.name}`,a=g(r,e),t=x(a,K);return await t,_(100),await b(a)}catch(e){throw new Error("Încărcarea imaginii a eșuat")}finally{X(!1)}})()}catch(s){return void O("Eroare la încărcarea imaginii. Vă rugăm încercați din nou.")}let l=T.galleryImages||[];if(Z.length>0)try{const e=await(async()=>{if(0===Z.length)return T.galleryImages||[];ie(!0);const e=[];try{for(const a of Z){const t=`articles/gallery/${(new Date).getTime()}_${a.name}`,s=g(r,t);await x(s,a);const l=await b(s);e.push(l)}return[...T.galleryImages||[],...e]}catch(a){throw new Error("Încărcarea imaginilor pentru galerie a eșuat")}finally{ie(!1)}})();l=[...T.galleryImages||[],...e]}catch(s){return void O("Eroare la încărcarea imaginilor pentru galerie. Vă rugăm încercați din nou.")}const i={title:T.title.trim(),content:T.content.trim(),author:(null==(a=T.author)?void 0:a.trim())||"Admin",imageUrl:e,published:T.published,tags:T.tags||[],preview:T.preview||T.content.substring(0,150)+(T.content.length>150?"...":""),date:T.date||ce(),readCount:T.readCount||0,readBy:T.readBy||[],feedback:T.feedback||[],galleryImages:l,coverStyle:T.coverStyle||"standard",updatedAt:d.now()};if(D){const e=c(t,"articles"),a={...i,createdAt:d.now(),updatedAt:d.now()};await m(e,a),B(!0),setTimeout((()=>F("/admin/articles")),2e3)}else{const e=n(t,"articles",I);await u(e,i),B(!0),setTimeout((()=>F("/admin/articles")),2e3)}}catch(s){"permission-denied"===s.code?O(`Nu ai permisiunea de a ${D?"crea":"actualiza"} acest articol.`):O(`A apărut o eroare la ${D?"crearea":"actualizarea"} articolului.`)}},children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"md:col-span-2",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"title",children:"Titlu"}),a.jsx("input",{type:"text",id:"title",name:"title",value:T.title,onChange:ne,className:"shadow-sm appearance-none border border-gray-300 rounded-md w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"content",children:"Conținut"}),a.jsx("textarea",{id:"content",name:"content",value:T.content,onChange:ne,rows:12,className:"shadow-sm appearance-none border border-gray-300 rounded-md w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"preview",children:["Text previzualizare",a.jsx("span",{className:"ml-2 text-sm font-normal text-gray-600",children:Q?"(generare automată)":"(personalizat)"})]}),a.jsx("textarea",{id:"preview",name:"preview",value:T.preview,onChange:ne,rows:3,className:"shadow-sm appearance-none border border-gray-300 rounded-md w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),a.jsx("div",{className:"mt-1 text-right",children:a.jsx("button",{type:"button",onClick:()=>{Y(!Q),Q||L((e=>{var a;return{...e,preview:(null==(a=e.content)?void 0:a.substring(0,150))+(e.content&&e.content.length>150?"...":"")}}))},className:"text-xs text-blue-600 hover:text-blue-800",children:Q?"Dezactivează generarea automată":"Activează generarea automată"})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"author",children:"Autor"}),a.jsx("input",{type:"text",id:"author",name:"author",value:T.author,onChange:ne,className:"shadow-sm appearance-none border border-gray-300 rounded-md w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"date",children:"Data articolului"}),a.jsx("input",{type:"text",id:"date",name:"date",value:T.date||ce(),onChange:ne,className:"shadow-sm appearance-none border border-gray-300 rounded-md w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"ex: 15 Aprilie 2023"}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format recomandat: zi luna an (ex: 15 Aprilie 2023)"})]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("label",{className:"block text-gray-700 text-sm font-bold mb-2 flex items-center",children:[a.jsx(f,{className:"mr-1"})," Etichete (Tags)"]}),a.jsxs("div",{className:"flex mb-2",children:[a.jsx("input",{type:"text",value:G,onChange:e=>V(e.target.value),className:"shadow-sm appearance-none border border-gray-300 rounded-l-md w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Adaugă un tag",onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),oe())}}),a.jsxs("button",{type:"button",onClick:oe,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-r-md flex items-center transition-colors",children:[a.jsx(j,{className:"mr-1"})," Adaugă"]})]}),T.tags&&T.tags.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:T.tags.map(((e,t)=>a.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs px-3 py-1 rounded-full flex items-center shadow-sm",children:[a.jsx(v,{className:"mr-1"})," ",e,a.jsx("button",{type:"button",onClick:()=>{return a=e,void L((e=>{var t;return{...e,tags:null==(t=e.tags)?void 0:t.filter((e=>e!==a))}}));var a},className:"ml-1 text-blue-800 hover:text-red-600 focus:outline-none",children:a.jsx(p,{})})]},t)))})]})]}),a.jsx("div",{className:"md:col-span-1 bg-gray-50 p-4 rounded-lg shadow-inner",children:a.jsxs("div",{className:"sticky top-20",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700 border-b pb-2",children:"Imagine copertă"}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center mb-2",children:[a.jsxs("label",{htmlFor:"imageUpload",className:"cursor-pointer bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-md flex items-center transition-colors",children:[a.jsx(N,{className:"mr-2"})," Încarcă imagine"]}),a.jsx("input",{type:"file",id:"imageUpload",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){const a=e.target.files[0];M(a);const t=URL.createObjectURL(a);J(t)}},className:"hidden"}),T.imageUrl&&a.jsx("button",{type:"button",onClick:async()=>{T.imageUrl&&T.imageUrl.includes("firebasestorage.googleapis.com")&&await(async e=>{try{const a=e.split("?")[0].split("/o/")[1];if(!a)return!1;const t=decodeURIComponent(a),s=g(r,t);return await h(s),!0}catch(a){return!1}})(T.imageUrl),J(""),M(null),L((e=>({...e,imageUrl:""})))},className:"ml-2 bg-red-500 hover:bg-red-600 text-white p-2 rounded-md transition-colors",title:"Șterge imaginea",children:a.jsx(w,{})})]}),a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:K?K.name:T.imageUrl?"Imagine încărcată":"Nicio imagine selectată"}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"imageUrl",children:"URL imagine (alternativ)"}),a.jsx("input",{type:"text",id:"imageUrl",name:"imageUrl",value:T.imageUrl,onChange:ne,placeholder:"https://example.com/image.jpg",className:"shadow-sm appearance-none border border-gray-300 rounded-md w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),W&&null!==P&&a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-2 mb-2",children:a.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all",style:{width:`${P}%`}})})]}),(H||T.imageUrl)&&a.jsx("div",{className:"mb-6 border rounded-lg overflow-hidden shadow-md",children:a.jsx("img",{src:H||T.imageUrl,alt:"Preview",className:"w-full h-40 object-cover"})}),a.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-700 border-b pb-2",children:"Stil afișare"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[a.jsxs("div",{onClick:()=>de("standard"),className:"border rounded p-2 cursor-pointer text-center "+("standard"===T.coverStyle?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-100"),children:[a.jsx("div",{className:"h-12 bg-gray-200 mb-2 rounded flex items-center justify-center text-xs text-gray-500",children:"Imagine sus"}),a.jsx("p",{className:"text-sm",children:"Standard"})]}),a.jsxs("div",{onClick:()=>de("side"),className:"border rounded p-2 cursor-pointer text-center "+("side"===T.coverStyle?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-100"),children:[a.jsx("div",{className:"h-12 bg-gray-200 mb-2 rounded flex items-center justify-center text-xs text-gray-500",children:"Imagine lateral"}),a.jsx("p",{className:"text-sm",children:"Lateral"})]}),a.jsxs("div",{onClick:()=>de("fullwidth"),className:"border rounded p-2 cursor-pointer text-center "+("fullwidth"===T.coverStyle?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-100"),children:[a.jsx("div",{className:"h-12 bg-gray-200 mb-2 rounded flex items-center justify-center text-xs text-gray-500",children:"Full width"}),a.jsx("p",{className:"text-sm",children:"Lățime completă"})]}),a.jsxs("div",{onClick:()=>de("overlay"),className:"border rounded p-2 cursor-pointer text-center "+("overlay"===T.coverStyle?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-100"),children:[a.jsx("div",{className:"h-12 bg-gray-200 mb-2 rounded flex items-center justify-center text-xs text-gray-500",children:"Text peste imagine"}),a.jsx("p",{className:"text-sm",children:"Overlay"})]})]}),a.jsx("div",{className:"mb-6",children:a.jsxs("label",{className:"flex items-center cursor-pointer",children:[a.jsx("div",{className:"w-10 h-6 rounded-full flex items-center transition-all duration-300 p-1 "+(T.published?"bg-green-500":"bg-gray-300"),children:a.jsx("div",{className:"bg-white w-4 h-4 rounded-full shadow transition-all duration-300 transform "+(T.published?"translate-x-4":"")})}),a.jsxs("div",{className:"ml-3 flex items-center",children:[T.published?a.jsxs(a.Fragment,{children:[a.jsx(C,{className:"text-green-600 mr-1"})," ",a.jsx("span",{className:"text-gray-700",children:"Publicat"})]}):a.jsxs(a.Fragment,{children:[a.jsx(S,{className:"text-gray-600 mr-1"})," ",a.jsx("span",{className:"text-gray-700",children:"Ascuns"})]}),a.jsx("input",{type:"checkbox",checked:T.published,onChange:()=>{L((e=>({...e,published:!e.published})))},className:"hidden"})]})]})})]})})]}),a.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h3",{className:"text-xl font-semibold text-gray-700",children:"Galerie imagini"}),a.jsx("button",{type:"button",onClick:()=>se(!re),className:"bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-md flex items-center transition-colors",children:re?a.jsxs(a.Fragment,{children:[a.jsx(p,{className:"mr-2"})," Închide"]}):a.jsxs(a.Fragment,{children:[a.jsx(j,{className:"mr-2"})," Adaugă imagini"]})})]}),re&&a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6 border border-gray-200",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsxs("label",{htmlFor:"galleryUpload",className:"cursor-pointer bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-md flex items-center transition-colors",children:[a.jsx(N,{className:"mr-2"})," Selectează imagini"]}),a.jsx("input",{type:"file",id:"galleryUpload",accept:"image/*",multiple:!0,onChange:e=>{if(e.target.files&&e.target.files.length>0){const a=Array.from(e.target.files);ee([...Z,...a]);const t=a.map((e=>URL.createObjectURL(e)));te([...ae,...t])}},className:"hidden"}),a.jsx("span",{className:"ml-3 text-sm text-gray-600",children:Z.length>0?`${Z.length} fișiere selectate`:"Niciun fișier selectat"})]}),a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Adaugă imagini suplimentare pentru articol. Acestea vor fi afișate într-o galerie sub conținutul principal."})]}),ae.length>0&&a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:ae.map(((e,t)=>a.jsxs("div",{className:"relative group border rounded-lg overflow-hidden shadow-sm",children:[a.jsx("img",{src:e,alt:`Gallery image ${t+1}`,className:"w-full h-32 object-cover"}),a.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all flex items-center justify-center opacity-0 group-hover:opacity-100",children:[a.jsx("button",{type:"button",onClick:()=>(e=>{Z.length>e&&ee(Z.filter(((a,t)=>t!==e))),te(ae.filter(((a,t)=>t!==e))),T.galleryImages&&T.galleryImages.length>e&&Z.length<=e&&L((a=>{var t;return{...a,galleryImages:null==(t=a.galleryImages)?void 0:t.filter(((a,t)=>t!==e))}}))})(t),className:"bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors",title:"Șterge imaginea",children:a.jsx(w,{})}),a.jsx("button",{type:"button",onClick:()=>{return a=e,L((e=>({...e,imageUrl:a}))),J(a),void M(null);var a},className:"bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition-colors ml-2",title:"Folosește ca imagine principală",children:a.jsx(U,{})})]})]},t)))})]}),a.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200 flex justify-between items-center",children:[a.jsxs("button",{type:"button",onClick:()=>F("/admin/articles"),className:"bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-md flex items-center transition-colors shadow-md",disabled:W||le,children:[a.jsx(p,{className:"mr-2"})," Anulează"]}),a.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-md flex items-center transition-colors shadow-md",disabled:W||le,children:W||le?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Se încarcă..."]}):a.jsxs(a.Fragment,{children:[a.jsx(k,{className:"mr-2"}),D?"Creează Articol":"Salvează Modificările"]})})]}),!D&&void 0!==T.readCount&&a.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[a.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-4",children:"Statistici articol"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-100 shadow-sm",children:a.jsxs("p",{className:"text-sm text-gray-700",children:["Număr de citiri: ",a.jsx("span",{className:"font-bold",children:T.readCount})]})}),a.jsx("div",{className:"bg-green-50 rounded-lg p-4 border border-green-100 shadow-sm",children:a.jsxs("p",{className:"text-sm text-gray-700",children:["Feedback-uri primite: ",a.jsx("span",{className:"font-bold",children:(null==(A=T.feedback)?void 0:A.length)||0})]})}),a.jsx("div",{className:"bg-yellow-50 rounded-lg p-4 border border-yellow-100 shadow-sm",children:a.jsxs("p",{className:"text-sm text-gray-700",children:["Ultima actualizare: ",a.jsx("span",{className:"font-bold",children:T.updatedAt?new Date(T.updatedAt.toDate()).toLocaleDateString("ro-RO"):"N/A"})]})})]})]})]})]})})};export{A as default};
