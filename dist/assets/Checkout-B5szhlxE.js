import{b as e,a,j as t,f as s}from"./index-wFNFqtXh.js";import{b as r,u as n}from"./vendor-BbhD7xee.js";import{z as l}from"./firebase-Bc5mL6iy.js";const i="localhost"===window.location.hostname,m=()=>{const{items:m,total:o,clearCart:d,shippingCost:c,finalTotal:u}=e(),{currentUser:x}=a(),[p,h]=r.useState({name:"",address:"",phone:"",email:"",paymentMethod:"cash"}),[b,g]=r.useState(null),[y,j]=r.useState(!1),N=n();r.useEffect((()=>{x&&h((e=>({...e,name:x.displayName||e.name,email:x.email||e.email})))}),[x]);const f=e=>{const{name:a,value:t}=e.target;h({...p,[a]:t})},w=e=>void 0===e?"":`${e.toFixed(2)} RON`,v=async()=>{const e=new Date,a=`LC-${`${e.getDate().toString().padStart(2,"0")}${(e.getMonth()+1).toString().padStart(2,"0")}${e.getFullYear().toString().slice(2)}`}-${Math.floor(1e3+9e3*Math.random())}`;await new Promise((e=>setTimeout(e,1200)));p.email,p.name,m.map((e=>`- ${e.name} x ${e.quantity} = ${w(e.price?e.price*e.quantity:0)}`)).join("\n      "),w(o),0===c||w(c),w(u),p.address,p.phone,"cash"===p.paymentMethod||p.paymentMethod,p.name,p.address,p.phone,"cash"===p.paymentMethod||p.paymentMethod,m.map((e=>`- ${e.name.toLowerCase().includes("afine")?"🫐":e.name.toLowerCase().includes("miere")?"🍯":"📦"} ${e.name} (Cantitate: ${e.quantity}, Preț: ${w(e.price||0)})`)).join("\n      "),w(o),0===c||w(c),w(u);return{success:!0,orderNumber:a,message:"Comandă procesată cu succes în mediul de dezvoltare",emailSent:!0,emailDetails:{toCustomer:p.email,toAdmin:"lupulsicorbul@gmail.com",subject:"Confirmare comandă",content:"Email simulat în consola browserului"}}},S=async()=>{try{const e={...p,items:m.map((e=>({id:e.id,name:e.name,price:e.price,quantity:e.quantity,image:e.image}))),totalAmount:u,orderDate:(new Date).toISOString(),shippingCost:c};if(i)return await v();const a=l(s,"sendOrderEmail");return(await a(e)).data}catch(e){throw e}};return t.jsxs("div",{className:"container mx-auto px-4 py-16",children:[t.jsx("h1",{className:"text-3xl font-bold mb-8 text-center text-gray-800",children:"Finalizează comanda"}),b&&t.jsx("div",{className:"bg-red-500 text-white p-4 rounded mb-4",children:b}),t.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[t.jsx("div",{className:"lg:w-1/2",children:t.jsxs("form",{onSubmit:async e=>{e.preventDefault(),g(null),j(!0);try{let e;if(i)e=await S();else try{e=await(async()=>{try{const e={...p,items:m.map((e=>({id:e.id,name:e.name,price:e.price,quantity:e.quantity,image:e.image}))),totalAmount:u,orderDate:(new Date).toISOString(),shippingCost:c};if(i)return await v();const a="https://sendorderemail-gcqoxopcwq-uc.a.run.app",t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const e=await t.text();throw new Error(`Eroare server: ${t.status} - ${e}`)}return await t.json()}catch(e){throw e}})()}catch(a){e=await S()}const t=e.orderNumber||"N/A";i&&localStorage.setItem("lastOrderDetails",JSON.stringify({orderNumber:t,customerName:p.name,customerEmail:p.email,totalAmount:u,items:m.length,date:(new Date).toISOString()})),d(),N("/checkout-success",{state:{orderNumber:t,customerName:p.name,customerEmail:p.email,totalAmount:u,items:m.length}})}catch(t){let e="A apărut o eroare la procesarea comenzii. Te rugăm să încerci din nou.";t.message&&(e+=` (Detalii: ${t.message})`),t.code,g(e)}finally{j(!1)}},className:"bg-white rounded-lg shadow-md p-8",children:[t.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800",children:"Date comandă"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"name",className:"block font-semibold mb-2 text-gray-700",children:"Nume complet"}),t.jsx("input",{type:"text",id:"name",name:"name",value:p.name,onChange:f,className:"w-full border border-gray-300 rounded px-3 py-2 text-gray-800",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"email",className:"block font-semibold mb-2 text-gray-700",children:"Email"}),t.jsx("input",{type:"email",id:"email",name:"email",value:p.email,onChange:f,className:"w-full border border-gray-300 rounded px-3 py-2 text-gray-800",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"address",className:"block font-semibold mb-2 text-gray-700",children:"Adresă"}),t.jsx("input",{type:"text",id:"address",name:"address",value:p.address,onChange:f,className:"w-full border border-gray-300 rounded px-3 py-2 text-gray-800",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"phone",className:"block font-semibold mb-2 text-gray-700",children:"Telefon"}),t.jsx("input",{type:"text",id:"phone",name:"phone",value:p.phone,onChange:f,className:"w-full border border-gray-300 rounded px-3 py-2 text-gray-800",required:!0})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{htmlFor:"paymentMethod",className:"block font-semibold mb-2 text-gray-700",children:"Metoda de plată"}),t.jsx("select",{id:"paymentMethod",name:"paymentMethod",value:p.paymentMethod,onChange:f,className:"w-full border border-gray-300 rounded px-3 py-2 text-gray-800",children:t.jsx("option",{value:"cash",children:"Ramburs"})}),t.jsxs("div",{className:"mt-4",children:[t.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Metode de plată acceptate:"}),t.jsx("img",{src:"/images/payment-methods.png",alt:"Metode de plată acceptate",className:"max-w-full h-auto"})]})]}),t.jsx("button",{type:"submit",disabled:y,className:`w-full ${y?"bg-blue-400":"bg-blue-600 hover:bg-blue-700"} text-white py-3 px-4 rounded-md transition-colors font-semibold`,children:y?"Se procesează...":"Trimite comanda"}),y&&t.jsx("p",{className:"text-center text-sm mt-2 text-blue-500",children:"Procesăm comanda ta, te rugăm să aștepți..."})]})}),t.jsx("div",{className:"lg:w-1/2",children:t.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8",children:[t.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800",children:"Sumar comandă"}),t.jsx("div",{className:"divide-y divide-gray-200",children:m.map((e=>t.jsxs("div",{className:"py-3 flex justify-between",children:[t.jsxs("div",{className:"text-gray-800",children:[t.jsx("span",{className:"font-medium",children:e.name}),t.jsxs("span",{className:"text-gray-600 ml-2",children:["x",e.quantity]})]}),t.jsx("div",{className:"font-medium text-gray-800",children:w(e.price?e.price*e.quantity:0)})]},e.id)))}),t.jsxs("div",{className:"mt-6 space-y-2 pt-4 border-t border-gray-200",children:[t.jsxs("div",{className:"flex justify-between text-gray-700",children:[t.jsx("span",{children:"Subtotal:"}),t.jsx("span",{children:w(o)})]}),t.jsxs("div",{className:"flex justify-between text-gray-700",children:[t.jsx("span",{children:"Cost transport:"}),t.jsx("span",{children:0===c?t.jsx("span",{className:"text-green-600 font-medium",children:"Gratuit"}):w(c)})]}),o&&o>=200&&0===c&&t.jsx("div",{className:"text-sm text-green-600",children:"Transport gratuit pentru comenzi peste 200 RON"}),t.jsxs("div",{className:"flex justify-between font-bold text-gray-800 pt-2 border-t border-gray-200 mt-2",children:[t.jsx("span",{children:"Total final:"}),t.jsx("span",{className:"text-blue-700 text-xl",children:w(u)})]})]})]})})]})]})};export{m as default};
