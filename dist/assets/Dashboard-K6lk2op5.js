import{a as e,j as s,d as t}from"./index-wFNFqtXh.js";import{u as a,b as i,L as r}from"./vendor-BbhD7xee.js";import{q as n,s as l,w as d,t as c,y as o,u as m,N as x}from"./firebase-Bc5mL6iy.js";import{j as u,k as h,m as p}from"./index-BlmLpygs.js";import{m as j}from"./motion-BkdF09aW.js";const g=()=>{var g,v,N;const{user:f,loading:b}=e(),w=a(),y=i.useRef(!1),[k,z]=i.useState(""),[S,L]=i.useState([]),[C,V]=i.useState(!0),[R,A]=i.useState(null),[M,B]=i.useState([]),[D,E]=i.useState(!0),[I,P]=i.useState(null),[H,T]=i.useState({}),[U,W]=i.useState({}),[O,F]=i.useState({});i.useEffect((()=>{b||f||y.current||(y.current=!0,w("/login",{replace:!0}))}),[f,b,w]),i.useEffect((()=>{const e=(new Date).getHours();z(e<12?"Bună dimineața":e<18?"Bună ziua":"Bună seara")}),[]),i.useEffect((()=>{(async()=>{if(f)try{V(!0);const e=n(t,"events"),s=l(e,d("registeredUsers","array-contains",f.uid)),a=(await c(s)).docs.map((e=>({id:e.id,...e.data()})));a.sort(((e,s)=>{if(!e.date&&!s.date)return 0;if(!e.date)return 1;if(!s.date)return-1;const t=new Date(e.date);return new Date(s.date).getTime()-t.getTime()})),L(a)}catch(e){A("A apărut o eroare la încărcarea evenimentelor.")}finally{V(!1)}})()}),[f]),i.useEffect((()=>{(async()=>{if(f)try{E(!0);const e=n(t,"orders"),s=l(e,d("userId","==",f.uid)),a=await c(s),i=[];for(const r of a.docs){const e=r.data(),s={id:r.id,...e,items:await Promise.all(e.items.map((async e=>{try{const s=await o(m(t,"products",e.id));return{...e,productDetails:s.exists()?s.data():null}}catch(s){return e}})))};i.push(s)}B(i)}catch(e){P("A apărut o eroare la încărcarea comenzilor.")}finally{E(!1)}})()}),[f]);const q=e=>{if(!e)return"Data necunoscută";try{const s={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString("ro-RO",s)}catch(s){return e}};if(b)return s.jsx("div",{className:"flex justify-center items-center min-h-screen",children:"Se încarcă..."});if(!f)return s.jsx("div",{className:"flex justify-center items-center min-h-screen",children:"Se redirecționează..."});const $=(null==f?void 0:f.firstName)||(null==(g=null==f?void 0:f.displayName)?void 0:g.split(" ")[0])||"Utilizator";return s.jsxs("div",{className:"container mx-auto px-4 py-16",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 text-center",children:[s.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[k,", ",s.jsx("span",{className:"text-blue-600",children:$}),"!"]}),s.jsx("p",{className:"text-gray-600 mt-2",children:"Bun venit înapoi pe panoul tău de control personal."})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-8",children:[s.jsxs(j.div,{className:"bg-white rounded-lg shadow-md p-6",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.1},children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx("div",{className:"w-14 h-14 rounded-full overflow-hidden bg-blue-100 flex items-center justify-center mr-4",children:(null==f?void 0:f.photoURL)?s.jsx("img",{src:f.photoURL,alt:"Avatar",className:"w-full h-full object-cover"}):s.jsx("span",{className:"text-xl font-bold text-blue-600",children:((null==(v=null==f?void 0:f.displayName)?void 0:v.charAt(0))||"").toUpperCase()})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-semibold",children:(null==f?void 0:f.displayName)||"Utilizator"}),s.jsx("p",{className:"text-gray-500 text-sm",children:null==f?void 0:f.email})]})]}),s.jsxs("div",{className:"mt-2 space-y-1",children:[(null==f?void 0:f.phoneNumber)&&s.jsxs("p",{className:"text-sm text-gray-600",children:[s.jsx("span",{className:"font-medium",children:"Telefon:"})," ",f.phoneNumber]}),(null==(N=null==f?void 0:f.address)?void 0:N.city)&&s.jsxs("p",{className:"text-sm text-gray-600",children:[s.jsx("span",{className:"font-medium",children:"Locație:"})," ",f.address.city,","," ",f.address.country||"România"]})]}),s.jsx("button",{onClick:()=>w("/profile"),className:"mt-4 w-full py-2 bg-blue-50 text-blue-600 rounded-md hover:bg-blue-100 transition duration-200 text-sm font-medium",children:"Editează Profilul"})]}),s.jsxs(j.div,{className:"bg-white rounded-lg shadow-md p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Acțiuni Rapide"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("button",{onClick:()=>w("/servicii"),className:"p-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-200 text-sm font-medium flex flex-col items-center",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Servicii"]}),s.jsxs("button",{onClick:()=>w("/magazin"),className:"p-3 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-200 text-sm font-medium flex flex-col items-center",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),"Magazin"]}),s.jsxs("button",{onClick:()=>w("/programari"),className:"p-3 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition duration-200 text-sm font-medium flex flex-col items-center",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Programări"]}),s.jsxs("button",{onClick:()=>w("/events"),className:"p-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition duration-200 text-sm font-medium flex flex-col items-center",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Evenimente"]})]})]}),s.jsxs(j.div,{className:"bg-white rounded-lg shadow-md p-6",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.3},children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Programări Viitoare"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"p-3 bg-blue-50 rounded-md border border-blue-100",children:[s.jsx("p",{className:"text-sm font-medium text-blue-800",children:"Sesiune de terapie"}),s.jsxs("div",{className:"flex justify-between items-center mt-2",children:[s.jsx("span",{className:"text-xs text-gray-600",children:"Vineri, 15 Iulie 2023, 15:00"}),s.jsx("button",{onClick:()=>w("/programari"),className:"text-xs text-blue-600 hover:underline",children:"Vezi detalii"})]})]}),s.jsxs("div",{className:"p-3 bg-purple-50 rounded-md border border-purple-100",children:[s.jsx("p",{className:"text-sm font-medium text-purple-800",children:"Atelier de grup"}),s.jsxs("div",{className:"flex justify-between items-center mt-2",children:[s.jsx("span",{className:"text-xs text-gray-600",children:"Sâmbătă, 23 Iulie 2023, 10:00"}),s.jsx("button",{onClick:()=>w("/programari"),className:"text-xs text-blue-600 hover:underline",children:"Vezi detalii"})]})]}),s.jsx("button",{onClick:()=>w("/programari"),className:"w-full text-sm text-blue-600 hover:underline mt-2",children:"Vezi toate programările"})]})]})]}),s.jsxs("section",{className:"mt-8",children:[s.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Activitate Recentă"}),s.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"bg-green-100 p-2 rounded-full mr-4",children:s.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:"Achiziție finalizată"}),s.jsx("p",{className:"text-sm text-gray-600",children:'Ai achiziționat "Set de meditație pentru începători"'}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Acum 2 zile"})]})]}),s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"bg-blue-100 p-2 rounded-full mr-4",children:s.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:"Programare confirmată"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Sesiune de terapie, Vineri 15 Iulie"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Acum 3 zile"})]})]}),s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"bg-yellow-100 p-2 rounded-full mr-4",children:s.jsx("svg",{className:"w-5 h-5 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 00-2-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:"Profil actualizat"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Ți-ai actualizat informațiile personale"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Acum 1 săptămână"})]})]})]})})]}),s.jsxs("section",{className:"mt-8",children:[s.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Participările Tale la Evenimente"}),s.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:C?s.jsxs("div",{className:"text-center py-4",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"mt-2 text-gray-600",children:"Se încarcă evenimentele..."})]}):R?s.jsx("div",{className:"text-center text-red-600 py-4",children:R}):0===S.length?s.jsxs("div",{className:"text-center py-6",children:[s.jsx("p",{className:"text-gray-600",children:"Nu ești înscris la niciun eveniment."}),s.jsx(r,{to:"/events",className:"mt-4 inline-block px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Descoperă Evenimente"})]}):s.jsx("div",{className:"space-y-4",children:S.map((e=>s.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[s.jsx("div",{className:"w-full md:w-24 h-24 overflow-hidden rounded-lg",children:s.jsx("img",{src:e.imageUrl||"/images/event-placeholder.jpg",alt:e.title,className:"w-full h-full object-cover"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-bold",children:e.title}),s.jsx("p",{className:"text-gray-600 text-sm",children:q(e.date)}),s.jsx("p",{className:"text-gray-600 text-sm",children:e.location||"Locație nedefinită"})]}),s.jsx("div",{children:s.jsx(r,{to:`/events/${e.id}`,className:"inline-block px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm",children:"Vezi detalii"})})]})},e.id)))})})]}),s.jsxs("section",{className:"mt-8",children:[s.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Comenzile Tale"}),s.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:D?s.jsx("div",{className:"text-center",children:"Se încarcă comenzile..."}):I?s.jsx("div",{className:"text-center text-red-600",children:I}):0===M.length?s.jsx("p",{className:"text-gray-600",children:"Nu ai făcut încă nicio comandă."}):s.jsx("div",{className:"space-y-6",children:M.map((e=>s.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsxs("h3",{className:"font-semibold",children:["Comanda #",e.id.substring(0,8)]}),s.jsx("span",{className:"text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString("ro-RO")})]}),s.jsx("div",{className:"space-y-4",children:e.items.map((e=>s.jsxs("div",{className:"order-rating-widget",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("img",{src:e.image||"/images/product-placeholder.jpg",alt:e.name,className:"w-16 h-16 object-cover rounded mr-4"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium",children:e.name}),s.jsxs("p",{className:"text-sm text-gray-500",children:["Cantitate: ",e.quantity," × ",void 0!==e.price?e.price.toFixed(2):"0.00"," RON"]})]})]}),s.jsxs("div",{className:"mt-3",children:[s.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Evaluează acest produs:"}),s.jsx("div",{className:"rating-stars-input",children:[1,2,3,4,5].map((a=>s.jsx("span",{className:"rating-star-input "+(H[e.id]>=a?"active":""),onClick:()=>(async(e,s)=>{var a;if(f){W({...U,[e]:!0});try{const i=m(t,"products",e),r=await o(i);if(!r.exists())throw new Error("Produsul nu a fost găsit");const n=r.data().ratings||{count:0,average:0,userRatings:[]},l=null==(a=n.userRatings)?void 0:a.findIndex((e=>e.userId===f.uid));let d;if(l>=0){const e=[...n.userRatings];e[l].rating=s;const t=e.reduce(((e,s)=>e+s.rating),0)/e.length;d={count:n.count,average:t,userRatings:e}}else{const e=n.count+1;d={count:e,average:(n.average*n.count+s)/e,userRatings:[...n.userRatings||[],{userId:f.uid,rating:s,date:(new Date).toISOString()}]}}await x(i,{ratings:d}),T({...H,[e]:s}),F({...O,[e]:!0}),setTimeout((()=>{F({...O,[e]:!1})}),3e3)}catch(i){alert("A apărut o eroare la trimiterea recenziei.")}finally{W({...U,[e]:!1})}}})(e.id,a),children:H[e.id]>=a?s.jsx(u,{}):s.jsx(h,{})},a)))}),U[e.id]&&s.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Se trimite evaluarea..."}),O[e.id]&&s.jsxs("p",{className:"text-xs text-green-600 mt-1 flex items-center",children:[s.jsx(p,{className:"mr-1"})," Evaluare trimisă cu succes"]})]})]},e.id)))}),s.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-100 flex justify-between",children:[s.jsxs("p",{className:"font-medium",children:["Total: ",e.total.toFixed(2)," RON"]}),s.jsxs("p",{className:"text-sm text-gray-500",children:["Status: ",e.status||"Finalizată"]})]})]},e.id)))})})]})]})};export{g as default};
