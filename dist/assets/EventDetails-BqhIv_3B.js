import{j as e,I as i,a,d as s,s as t}from"./index-wFNFqtXh.js";import{b as r,f as n,u as l,L as c}from"./vendor-BbhD7xee.js";import{u as o,y as d,N as u,O as m,P as p}from"./firebase-Bc5mL6iy.js";import{B as x}from"./Button-BT6LlECB.js";import{E as g}from"./ErrorMessage-BUKWsR5Z.js";const v=({label:i,error:a,fullWidth:s=!0,helperText:t,className:r="",id:n,rows:l=4,...c})=>{const o=n||`textarea-${Math.random().toString(36).substring(2,11)}`,d=`\n    px-3 py-2 bg-white border rounded-md text-gray-700\n    focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n    disabled:bg-gray-100 disabled:cursor-not-allowed\n    transition-all\n    ${a?"border-red-500":"border-gray-300"}\n    ${s?"w-full":""}\n    ${r}\n  `.trim();return e.jsxs("div",{className:"mb-4 "+(s?"w-full":""),children:[i&&e.jsx("label",{htmlFor:o,className:"block text-sm font-medium text-gray-700 mb-1",children:i}),e.jsx("textarea",{id:o,className:d,rows:l,...c}),a&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a}),t&&!a&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t})]})},h=({onInfoSubmit:a,initialValues:s={}})=>{const[t,n]=r.useState({fullName:s.fullName||"",expectations:s.expectations||"",age:s.age||""}),[l,c]=r.useState({}),o=e=>{const{name:i,value:a}=e.target;n((e=>({...e,[i]:a}))),l[i]&&c((e=>({...e,[i]:void 0})))};return e.jsxs("form",{onSubmit:e=>{e.preventDefault(),(()=>{const e={};let i=!0;return t.fullName.trim()||(e.fullName="Numele complet este obligatoriu",i=!1),t.expectations.trim()||(e.expectations="Vă rugăm să completați așteptările",i=!1),t.age.trim()?(isNaN(Number(t.age))||Number(t.age)<16||Number(t.age)>100)&&(e.age="Vă rugăm să introduceți o vârstă validă (între 16 și 100)",i=!1):(e.age="Vârsta este obligatorie",i=!1),c(e),i})()&&a(t)},className:"space-y-4",children:[e.jsx(i,{label:"Nume complet",name:"fullName",value:t.fullName,onChange:o,placeholder:"Introduceți numele și prenumele",error:l.fullName,required:!0}),e.jsx(i,{label:"Vârsta",name:"age",type:"number",value:t.age,onChange:o,placeholder:"Introduceți vârsta",error:l.age,required:!0,min:"16",max:"100"}),e.jsx(v,{label:"Ce așteptări aveți de la acest eveniment?",name:"expectations",value:t.expectations,onChange:o,placeholder:"Scrieți aici ce doriți să obțineți din participarea la acest eveniment...",error:l.expectations,rows:4,required:!0}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(x,{type:"submit",variant:"primary",children:"Înregistrează-mă"})})]})},b=({imageUrl:i,eventId:a,title:s,className:t=""})=>{const[n,l]=r.useState(i||""),[c,o]=r.useState(!1),d={z082QKm5JqvvxeLQjfmz:"/images/Afis 2.jpg"};return e.jsx("div",{className:`relative ${t}`,children:e.jsx("img",{src:n,alt:s||"Eveniment",className:"w-full h-full object-cover",onError:()=>{o(!0),a&&d[a]?l(d[a]):n.includes("public/images/")?l(n.replace("public/images/","/images/")):n.includes("public\\images\\")?l(n.replace("public\\images\\","/images/")):n.startsWith("http")||n.startsWith("/")||!n.includes("/")?(n===i||c)&&l("/images/BussinesLider.jpg"):l(`/images/${n.split("/").pop()}`)}})})},f=()=>{var i;const{id:x}=n(),v=l(),{currentUser:f}=a(),[j,N]=r.useState(null),[y,w]=r.useState(!0),[S,U]=r.useState(null),[k,L]=r.useState(null),[z,C]=r.useState(!1),T=e=>{const i=new Date;return i.setHours(0,0,0,0),new Date(e)<i};r.useEffect((()=>{(async()=>{if(!x)return U("ID-ul evenimentului lipsește."),void v("/events");try{w(!0);const e=o(s,"events",x),i=await d(e);i.exists()?N({id:i.id,...i.data()}):U("Evenimentul nu a fost găsit.")}catch(e){U("A apărut o eroare la încărcarea detaliilor evenimentului.")}finally{w(!1)}})()}),[x,v]);const E=f&&(null==(i=null==j?void 0:j.registeredUsers)?void 0:i.includes(f.uid)),I=async e=>{var i;if(f&&j)if(T(j.date))U("Nu te poți înscrie la un eveniment care a trecut.");else try{U(null);const r=o(s,"events",x);await u(r,{registeredUsers:p(f.uid)});const n=(await d(r)).data(),l=(null==(i=null==n?void 0:n.registeredUsers)?void 0:i.length)||1;try{await t({eventId:x,eventTitle:j.title,eventDate:j.date,eventLocation:j.location,participantCount:l,user:{id:f.uid,email:f.email||"fara email",displayName:f.displayName||"Utilizator nedenumit"},participant:e})}catch(a){}L("Te-ai înscris cu succes la acest eveniment!"),N({...j,registeredUsers:[...j.registeredUsers||[],f.uid]})}catch(r){U("A apărut o eroare la înscrierea la eveniment. Te rugăm să încerci din nou.")}};return y?e.jsx("div",{className:"container mx-auto px-4 py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Se încarcă detaliile evenimentului..."})]})}):S||!j?e.jsxs("div",{className:"container mx-auto px-4 py-16",children:[e.jsx(g,{message:S||"A apărut o eroare la încărcarea evenimentului.",onRetry:()=>window.location.reload()}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(c,{to:"/events",className:"text-blue-600 hover:underline",children:"Înapoi la evenimente"})})]}):e.jsx("div",{className:"bg-gray-50 py-16",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsx("div",{className:"mb-8",children:e.jsxs(c,{to:"/events",className:"text-blue-600 hover:underline flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Înapoi la evenimente"]})}),z?e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 md:p-8 mt-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Completează informațiile pentru înregistrare"}),e.jsx(h,{onInfoSubmit:async e=>{C(!1),await I(e)},initialValues:{fullName:(null==f?void 0:f.displayName)||"",expectations:"",age:""}}),e.jsx("button",{onClick:()=>C(!1),className:"mt-4 text-gray-600 hover:underline",children:"Anulează"})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"h-64 md:h-96 w-full relative",children:e.jsx(b,{imageUrl:j.imageUrl||"/images/BussinesLider.jpg",eventId:x||"",title:j.title||"Eveniment",className:"h-full"})}),e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"mb-4 text-blue-600 font-medium",children:[j.date?(D=j.date,new Date(D).toLocaleDateString("ro-RO",{year:"numeric",month:"long",day:"numeric"})):"Data indisponibilă"," • ",j.time||"Ora indisponibilă"]}),e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-4xl font-bold mb-4",children:j.title||"Titlu indisponibil"}),e.jsxs("div",{className:"flex items-center text-gray-600 mb-6",children:[e.jsxs("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:j.location||"Locație indisponibilă"})]}),e.jsx("div",{className:"prose max-w-none mb-8",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:j.description||"Descriere indisponibilă"})}),k&&e.jsx("div",{className:"mb-4 p-4 bg-green-100 text-green-700 rounded-md",children:k}),S&&e.jsx(g,{message:S,type:"warning",onRetry:()=>U(null)}),e.jsx("div",{className:"border-t border-gray-200 pt-6 mt-6",children:e.jsxs("div",{className:"flex flex-wrap justify-between items-center",children:[e.jsxs("div",{className:"mb-4 md:mb-0",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Capacitate:"})," ",j.capacity||"Necunoscut"," participanți"]}),j.registeredUsers&&e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Înscriși:"})," ",j.registeredUsers.length," participanți"]})]}),E?e.jsx("button",{onClick:async()=>{var e;if(f&&j){if(window.confirm("Ești sigur că vrei să anulezi înscrierea la acest eveniment?"))try{U(null),w(!0);const i=o(s,"events",x);if(!f.uid)throw new Error("Sesiune de autentificare invalidă. Te rugăm să te reautentifici.");await u(i,{registeredUsers:m(f.uid)}),N({...j,registeredUsers:(null==(e=j.registeredUsers)?void 0:e.filter((e=>e!==f.uid)))||[]}),L("Înscrierea ta a fost anulată cu succes."),setTimeout((()=>{L(null)}),3e3)}catch(i){"permission-denied"===i.code?U("Nu ai permisiunea să anulezi această înscriere. Te rugăm să contactezi administratorul."):i.message&&i.message.includes("permissions")?U("Problemă de permisiuni. Te rugăm să te reautentifici și să încerci din nou."):U("A apărut o eroare la anularea înscrierii. Te rugăm să încerci din nou.")}finally{w(!1)}}else U("Trebuie să fii autentificat pentru a anula înscrierea.")},className:"py-2 px-6 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:"Anulează înscrierea"}):T(j.date)?e.jsx("div",{className:"py-2 px-6 bg-gray-400 text-white rounded-md cursor-not-allowed",children:"Eveniment încheiat"}):e.jsx("button",{onClick:()=>{var e;f?j?T(j.date)?U("Nu te poți înscrie la un eveniment care a trecut."):(null==(e=j.registeredUsers)?void 0:e.includes(f.uid))?U("Ești deja înscris la acest eveniment."):C(!0):U("Informațiile evenimentului nu sunt disponibile."):alert("Trebuie să fii autentificat pentru a te înscrie la acest eveniment.")},className:"py-2 px-6 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Înscrie-te la eveniment"})]})})]})]})]})});var D};export{f as default};
