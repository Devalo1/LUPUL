import{j as e,I as a,a as t,d as i,s}from"./index-Bwkz9jAa.js";import{b as r,f as n,u as l,L as c}from"./vendor-ClDHXAES.js";import{u as o,A as d,N as m,O as u,q as p,s as x,w as g,t as v,P as h,Q as f,M as b}from"./firebase-DUCcfN4Q.js";import"./ThemeContext-DrZ0fxr9.js";import{B as j}from"./Button-C6AojUBv.js";import{E as N}from"./ErrorMessage-BQ-WfWLX.js";const y=({label:a,error:t,fullWidth:i=!0,helperText:s,className:r="",id:n,rows:l=4,...c})=>{const o=n||`textarea-${Math.random().toString(36).substring(2,11)}`,d=`\n    px-3 py-2 bg-white border rounded-md text-gray-700\n    focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n    disabled:bg-gray-100 disabled:cursor-not-allowed\n    transition-all\n    ${t?"border-red-500":"border-gray-300"}\n    ${i?"w-full":""}\n    ${r}\n  `.trim();return e.jsxs("div",{className:"mb-4 "+(i?"w-full":""),children:[a&&e.jsx("label",{htmlFor:o,className:"block text-sm font-medium text-gray-700 mb-1",children:a}),e.jsx("textarea",{id:o,className:d,rows:l,...c}),t&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t}),s&&!t&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:s})]})},w=({onInfoSubmit:t,initialValues:i={}})=>{const[s,n]=r.useState({fullName:i.fullName||"",expectations:i.expectations||"",age:i.age||""}),[l,c]=r.useState({}),o=e=>{const{name:a,value:t}=e.target;n((e=>({...e,[a]:t}))),l[a]&&c((e=>({...e,[a]:void 0})))};return e.jsxs("form",{onSubmit:e=>{e.preventDefault(),(()=>{const e={};let a=!0;return s.fullName.trim()||(e.fullName="Numele complet este obligatoriu",a=!1),s.expectations.trim()||(e.expectations="Vă rugăm să completați așteptările",a=!1),s.age.trim()?(isNaN(Number(s.age))||Number(s.age)<16||Number(s.age)>100)&&(e.age="Vă rugăm să introduceți o vârstă validă (între 16 și 100)",a=!1):(e.age="Vârsta este obligatorie",a=!1),c(e),a})()&&t(s)},className:"space-y-4",children:[e.jsx(a,{label:"Nume complet",name:"fullName",value:s.fullName,onChange:o,placeholder:"Introduceți numele și prenumele",error:l.fullName,required:!0}),e.jsx(a,{label:"Vârsta",name:"age",type:"number",value:s.age,onChange:o,placeholder:"Introduceți vârsta",error:l.age,required:!0,min:"16",max:"100"}),e.jsx(y,{label:"Ce așteptări aveți de la acest eveniment?",name:"expectations",value:s.expectations,onChange:o,placeholder:"Scrieți aici ce doriți să obțineți din participarea la acest eveniment...",error:l.expectations,rows:4,required:!0}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx(j,{type:"submit",variant:"primary",children:"Înregistrează-mă"})})]})},S=({imageUrl:a,eventId:t,title:i,className:s=""})=>{const[n,l]=r.useState(a||""),[c,o]=r.useState(!1),d={z082QKm5JqvvxeLQjfmz:"/images/Afis 2.jpg"};return e.jsx("div",{className:`relative ${s}`,children:e.jsx("img",{src:n,alt:i||"Eveniment",className:"w-full h-full object-cover",onError:()=>{o(!0),t&&d[t]?l(d[t]):n.includes("public/images/")?l(n.replace("public/images/","/images/")):n.includes("public\\images\\")?l(n.replace("public\\images\\","/images/")):n.startsWith("http")||n.startsWith("/")||!n.includes("/")?(n===a||c)&&l("/images/BussinesLider.jpg"):l(`/images/${n.split("/").pop()}`)}})})},E=()=>{const{id:a}=n(),j=l(),{currentUser:y}=t(),[E,U]=r.useState(null),[k,I]=r.useState(!0),[L,T]=r.useState(null),[C,z]=r.useState(null),[D,A]=r.useState(!1),$=e=>{const a=new Date;return a.setHours(0,0,0,0),new Date(e)<a};r.useEffect((()=>{(async()=>{if(!a)return T("ID-ul evenimentului lipsește."),void j("/events");try{I(!0);const e=o(i,"events",a),t=await d(e);t.exists()?U({id:t.id,...t.data()}):T("Evenimentul nu a fost găsit.")}catch(e){T("A apărut o eroare la încărcarea detaliilor evenimentului.")}finally{I(!1)}})()}),[a,j]);const B=()=>!(!y||!(null==E?void 0:E.registeredUsers))&&E.registeredUsers.includes(y.uid),M=async e=>{var t;if(y&&E)if($(E.date))T("Nu te poți înscrie la un eveniment care a trecut.");else try{T(null);const l=o(i,"events",a);await m(l,{registeredUsers:f(y.uid)});const c=(await d(l)).data(),u=(null==(t=null==c?void 0:c.registeredUsers)?void 0:t.length)||1,x={eventId:a,eventTitle:E.title,userId:y.uid,userEmail:y.email||"",name:e.fullName,email:y.email||"",phone:"",additionalInfo:e.expectations,createdAt:new Date,status:"confirmed"};try{const e=p(i,"eventRegistrations");await b(e,x)}catch(r){}try{await s({eventId:a,eventTitle:E.title,eventDate:E.date,eventLocation:E.location,participantCount:u,user:{id:y.uid,email:y.email||"fara email",displayName:y.displayName||"Utilizator nedenumit"},participant:{fullName:e.fullName,expectations:e.expectations||"",age:e.age||""}})}catch(n){}z("Te-ai înscris cu succes la acest eveniment!"),U((e=>e?{...e,registeredUsers:[...e.registeredUsers||[],y.uid]}:null))}catch(l){l instanceof Error?T(`Eroare la înscrierea la eveniment: ${l.message}`):T("string"==typeof l?`Eroare la înscrierea la eveniment: ${l}`:"A apărut o eroare la înscrierea la eveniment. Te rugăm să încerci din nou.")}};return k?e.jsx("div",{className:"container mx-auto px-4 py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Se încarcă detaliile evenimentului..."})]})}):L||!E?e.jsxs("div",{className:"container mx-auto px-4 py-16",children:[e.jsx(N,{message:L||"A apărut o eroare la încărcarea evenimentului.",onRetry:()=>window.location.reload()}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(c,{to:"/events",className:"text-blue-600 hover:underline",children:"Înapoi la evenimente"})})]}):e.jsx("div",{className:"bg-gray-50 py-16",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsx("div",{className:"mb-8",children:e.jsxs(c,{to:"/events",className:"text-blue-600 hover:underline flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Înapoi la evenimente"]})}),D?e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 md:p-8 mt-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Completează informațiile pentru înregistrare"}),e.jsx(w,{onInfoSubmit:async e=>{A(!1),await M(e)},initialValues:{fullName:(null==y?void 0:y.displayName)||"",expectations:"",age:""}}),e.jsx("button",{onClick:()=>A(!1),className:"mt-4 text-gray-600 hover:underline",children:"Anulează"})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"h-64 md:h-96 w-full relative",children:e.jsx(S,{imageUrl:E.imageUrl||"/images/BussinesLider.jpg",eventId:a||"",title:E.title||"Eveniment",className:"h-full"})}),e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"mb-4 text-blue-600 font-medium",children:[E.date?(V=E.date,new Date(V).toLocaleDateString("ro-RO",{year:"numeric",month:"long",day:"numeric"})):"Data indisponibilă"," • ",E.time||"Ora indisponibilă"]}),e.jsx("h1",{className:"text-2xl md:text-3xl lg:text-4xl font-bold mb-4",children:E.title||"Titlu indisponibil"}),e.jsxs("div",{className:"flex items-center text-gray-600 mb-6",children:[e.jsxs("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:E.location||"Locație indisponibilă"})]}),e.jsx("div",{className:"prose max-w-none mb-8",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:E.description||"Descriere indisponibilă"})}),C&&e.jsx("div",{className:"mb-4 p-4 bg-green-100 text-green-700 rounded-md",children:C}),L&&e.jsx(N,{message:L,type:"warning",onRetry:()=>T(null)}),e.jsx("div",{className:"border-t border-gray-200 pt-6 mt-6",children:e.jsxs("div",{className:"flex flex-wrap justify-between items-center",children:[e.jsxs("div",{className:"mb-4 md:mb-0",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Capacitate:"})," ",E.capacity||"Necunoscut"," participanți"]}),E.registeredUsers&&e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Înscriși:"})," ",E.registeredUsers.length," participanți"]})]}),B()?e.jsx("button",{onClick:async()=>{var e;if(y&&E){if(window.confirm("Ești sigur că vrei să anulezi înscrierea la acest eveniment?"))try{T(null),I(!0);const s=o(i,"events",a);if(!y.uid)throw new Error("Sesiune de autentificare invalidă. Te rugăm să te reautentifici.");await m(s,{registeredUsers:u(y.uid)});try{const e=p(i,"eventRegistrations"),t=x(e,g("eventId","==",a),g("userId","==",y.uid)),s=await v(t);if(!s.empty){const e=h(i);s.docs.forEach((a=>{e.delete(a.ref)})),await e.commit()}}catch(t){}U({...E,registeredUsers:(null==(e=E.registeredUsers)?void 0:e.filter((e=>e!==y.uid)))||[]}),z("Înscrierea ta a fost anulată cu succes."),setTimeout((()=>{z(null)}),3e3)}catch(s){"permission-denied"===s.code?T("Nu ai permisiunea să anulezi această înscriere. Te rugăm să contactezi administratorul."):s.message&&s.message.includes("permissions")?T("Problemă de permisiuni. Te rugăm să te reautentifici și să încerci din nou."):T("A apărut o eroare la anularea înscrierii. Te rugăm să încerci din nou.")}finally{I(!1)}}else T("Trebuie să fii autentificat pentru a anula înscrierea.")},className:"py-2 px-6 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:"Anulează înscrierea"}):$(E.date)?e.jsx("div",{className:"py-2 px-6 bg-gray-400 text-white rounded-md cursor-not-allowed",children:"Eveniment încheiat"}):e.jsx("button",{onClick:()=>{y?E?$(E.date)?T("Nu te poți înscrie la un eveniment care a trecut."):B()?T("Ești deja înscris la acest eveniment."):A(!0):T("Informațiile evenimentului nu sunt disponibile."):alert("Trebuie să fii autentificat pentru a te înscrie la acest eveniment.")},className:"py-2 px-6 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Înscrie-te la eveniment"})]})})]})]})]})});var V};export{E as default};
