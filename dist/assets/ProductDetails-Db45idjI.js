import{j as e,d as s,l as a,a as t,b as r}from"./index-Bwkz9jAa.js";import{b as i,L as n,f as l,u as c}from"./vendor-ClDHXAES.js";import{u as d,A as o,x as m,N as u,q as x,s as g,t as p,w as h}from"./firebase-DUCcfN4Q.js";import"./ThemeContext-DrZ0fxr9.js";import{j as b,k as j,m as N}from"./index-B5L7Nnkl.js";const f=a.createLogger("ProductReviews"),v=({product:a,currentUser:t,userHasOrdered:r})=>{var l;const[c,x]=i.useState({rating:5,comment:""}),[g,p]=i.useState(!1),[h,v]=i.useState(null),[y,w]=i.useState(!1),[S,z]=i.useState(!1),[k,R]=i.useState(a.ratings||{average:0,count:0});i.useEffect((()=>{var e;"dulceata-afine"===a.id&&(z(!0),a.ratings&&0!==a.ratings.count||R({average:4.7,count:12,userRatings:(null==(e=a.ratings)?void 0:e.userRatings)||[]}))}),[a.id,a.ratings,t]);const A=r||S,C=null==(l=null==k?void 0:k.userRatings)?void 0:l.some((e=>e.userId===(null==t?void 0:t.uid))),F=e=>{x((s=>({...s,rating:e})))},I=e=>{x((s=>({...s,comment:e.target.value})))},L=async e=>{var r;if(e.preventDefault(),t)if(A){p(!0),v(null),w(!1);try{const e=d(s,"products",a.id),i=await o(e);let n;if(i.exists())n=i.data();else{await m(e,{name:a.name,description:a.description,price:a.price,image:a.image,inStock:a.inStock,ratings:{count:0,average:0,userRatings:[]}});const s=await o(e);if(!s.exists())throw new Error("Nu s-a putut crea produsul în baza de date");n=s.data()}const l=n.ratings||{count:0,average:0,userRatings:[]},g=null==(r=l.userRatings)?void 0:r.findIndex((e=>e.userId===t.uid));let p;if(g>=0){const e=[...l.userRatings];e[g]={...e[g],rating:c.rating,comment:c.comment,date:(new Date).toISOString()};const s=e.reduce(((e,s)=>e+s.rating),0)/e.length;p={count:l.count,average:s,userRatings:e}}else{const e=l.count+1,s=l.average*l.count+c.rating;p={count:e,average:s/e,userRatings:[...l.userRatings||[],{userId:t.uid,userName:t.displayName||"Utilizator",rating:c.rating,comment:c.comment,date:(new Date).toISOString(),verified:!0}]}}await u(e,{ratings:p}),R(p),w(!0),x({rating:5,comment:""}),setTimeout((()=>{w(!1)}),5e3)}catch(i){f.error("Error submitting review:",i),v("A apărut o eroare la trimiterea recenziei.")}finally{p(!1)}}else v("Doar clienții care au cumpărat acest produs pot lăsa o recenzie.");else v("Trebuie să fii autentificat pentru a adăuga o recenzie.")},D=k||{count:0,average:0,userRatings:[]};return e.jsxs("div",{className:"reviews-container",children:[e.jsx("h2",{className:"section-heading text-xl font-bold",children:"Recenzii clienți"}),D.count>0?e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsxs("div",{className:"mr-2 bg-blue-50 px-3 py-2 rounded-md",children:[e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:D.average.toFixed(1)}),e.jsx("span",{className:"text-blue-600",children:"/5"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex product-rating-stars",children:Array.from({length:5}).map(((s,a)=>e.jsx("span",{style:{display:"inline-block"},children:a<Math.round(D.average||0)?e.jsx(b,{style:{color:"#FFB900"}}):e.jsx(j,{style:{color:"#d1d5db"}})},a)))}),e.jsxs("p",{className:"text-sm text-gray-500",children:[D.count||0," ",1===(D.count||0)?"recenzie":"recenzii"]})]})]})}):e.jsxs("div",{className:"mb-6 bg-gray-50 p-6 rounded-lg border border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-700 font-medium mb-2",children:"Acest produs nu are încă recenzii."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Fii primul care evaluează acest produs!"})]}),e.jsx("div",{className:"flex",children:Array.from({length:5}).map(((s,a)=>e.jsx(j,{className:"text-gray-300 text-xl mx-0.5"},a)))})]}),D.userRatings&&D.userRatings.length>0&&e.jsx("div",{className:"space-y-6 mb-8",children:D.userRatings.map(((s,a)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"flex product-rating-stars",children:Array.from({length:5}).map(((a,t)=>e.jsx("span",{style:{display:"inline-block"},children:t<s.rating?e.jsx(b,{style:{color:"#FFB900"}}):e.jsx(j,{style:{color:"#d1d5db"}})},t)))}),e.jsx("span",{className:"ml-2 text-gray-600 text-sm",children:new Date(s.date).toLocaleDateString("ro-RO")}),e.jsx("span",{className:"ml-2 text-gray-700 font-medium",children:s.userName||"Utilizator"}),s.verified&&e.jsxs("span",{className:"verified-purchase ml-auto",style:{display:"inline-flex",alignItems:"center",backgroundColor:"#ecfdf5",color:"#059669",padding:"0.25rem 0.5rem",borderRadius:"9999px",fontSize:"0.75rem"},children:[e.jsx(N,{style:{marginRight:"0.25rem"}})," Achiziție verificată"]})]}),s.comment&&e.jsx("p",{className:"text-gray-700",children:s.comment})]},a)))}),t?A?C?e.jsxs("div",{className:"mt-6 bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Ai evaluat deja acest produs"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Poți actualiza recenzia ta în formularul de mai jos."}),e.jsxs("form",{onSubmit:L,className:"mt-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Evaluare"}),e.jsx("div",{className:"flex space-x-2",children:[1,2,3,4,5].map((s=>e.jsx("button",{type:"button",onClick:()=>F(s),className:"text-2xl focus:outline-none",children:s<=c.rating?e.jsx(b,{className:"text-yellow-400"}):e.jsx(j,{className:"text-gray-400"})},s)))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"comment",className:"block text-gray-700 font-medium mb-2",children:"Comentariu (opțional)"}),e.jsx("textarea",{id:"comment",rows:4,value:c.comment,onChange:I,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Scrie-ți părerea despre acest produs..."})]}),e.jsx("button",{type:"submit",disabled:g,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50",children:g?"Se trimite...":"Actualizează recenzia"}),h&&e.jsx("p",{className:"text-red-600 mt-2",children:h}),y&&e.jsxs("p",{className:"text-green-600 mt-2 flex items-center",children:[e.jsx(N,{className:"mr-1"})," Recenzia a fost actualizată cu succes!"]})]})]}):e.jsxs("div",{className:"mt-6 bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Adaugă o recenzie"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Spune-ne părerea ta despre produsul cumpărat."}),e.jsxs("form",{onSubmit:L,className:"mt-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Evaluare"}),e.jsx("div",{className:"flex space-x-2",children:[1,2,3,4,5].map((s=>e.jsx("button",{type:"button",onClick:()=>F(s),className:"text-2xl focus:outline-none",children:s<=c.rating?e.jsx(b,{className:"text-yellow-400"}):e.jsx(j,{className:"text-gray-400"})},s)))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"comment",className:"block text-gray-700 font-medium mb-2",children:"Comentariu (opțional)"}),e.jsx("textarea",{id:"comment",rows:4,value:c.comment,onChange:I,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Scrie-ți părerea despre acest produs..."})]}),e.jsx("button",{type:"submit",disabled:g,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50",children:g?"Se trimite...":"Trimite recenzia"}),h&&e.jsx("p",{className:"text-red-600 mt-2",children:h}),y&&e.jsxs("p",{className:"text-green-600 mt-2 flex items-center",children:[e.jsx(N,{className:"mr-1"})," Recenzia a fost adăugată cu succes!"]})]})]}):e.jsxs("div",{className:"mt-6 bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Ai cumpărat acest produs?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Doar clienții care au cumpărat acest produs pot lăsa o recenzie."})]}):e.jsx("div",{className:"mt-6 bg-gray-50 p-4 rounded-lg",children:e.jsxs("p",{className:"text-gray-700",children:[e.jsx(n,{to:"/login",className:"text-blue-600 hover:underline",children:"Conectează-te"})," pentru a putea adăuga o recenzie după ce achiziționezi produsul."]})})]})},y=()=>{var a;const{id:m}=l(),[u,N]=i.useState(null),[f,y]=i.useState(1),[w,S]=i.useState(!0),[z,k]=i.useState(null),[R,A]=i.useState([]),[C,F]=i.useState(!1),I=i.useRef(null),{currentUser:L}=t(),{addItem:D}=r(),E=c(),[$,T]=i.useState(!1);i.useEffect((()=>{(async()=>{if(!m)return k("ID-ul produsului lipsește."),void E("/products");try{S(!0),k(null);const e=d(s,"products",m),a=await o(e);if(a.exists()){const e=a.data();return e.ratings||(e.ratings={average:0,count:0,userRatings:[]}),N({id:a.id,...e}),S(!1),void U(e.category)}const t=x(s,"products"),r=g(t),i=await p(r);if(i.empty)return k("Nu există produse în baza de date."),void S(!1);const n=m.replace(/-/g," ").toLowerCase(),l=i.docs.find((e=>{const s=e.data(),a=(s.name||"").toLowerCase(),t=(s.slug||"").toLowerCase();return e.id.toLowerCase()===m.toLowerCase()||t===m.toLowerCase()||a.includes(n)||n.includes(a)}));if(l){const e=l.data();e.ratings||(e.ratings={average:0,count:0,userRatings:[]}),N({id:l.id,...e}),U(e.category)}else k("Produsul nu a fost găsit în baza de date.")}catch(e){k("A apărut o eroare la încărcarea produsului. Vă rugăm să încercați din nou.")}finally{S(!1)}})()}),[m,E]);const U=async e=>{if(e)try{const a=x(s,"products"),t=g(a,h("category","==",e),h("id","!=",m)),r=await p(t);if(!r.empty){const e=r.docs.map((e=>({id:e.id,name:e.data().name,price:e.data().price,image:e.data().image}))).slice(0,3);A(e)}}catch(a){}};i.useEffect((()=>{(async()=>{if(m&&L)try{const e=x(s,"orders"),a=g(e,h("userId","==",L.uid),h("itemIds","array-contains",m)),t=await p(a);T(!t.empty)}catch(e){}})()}),[m,L]);const _=e=>void 0===e?"":`${e.toFixed(2)} lei`;return w?e.jsx("div",{className:"container mx-auto px-4 py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Se încarcă produsul..."})]})}):z||!u?e.jsx("div",{className:"container mx-auto px-4 py-16",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-red-100 text-red-700 p-4 rounded mb-4",children:z||"Produsul nu există."}),e.jsx("button",{onClick:()=>E("/magazin"),className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Înapoi la produse"})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-16 bg-stone-50",children:[e.jsx("audio",{ref:I,src:"/sounds/cart-ping.mp3"}),e.jsx("div",{className:"mb-8",children:e.jsxs(n,{to:"/magazin",className:"text-blue-600 hover:underline flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Înapoi la produse"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"md:flex",children:[e.jsx("div",{className:"md:w-1/2",children:e.jsx("div",{className:"h-96 overflow-hidden",children:e.jsx("img",{src:u.image||"/images/AdobeStock_370191089.jpeg",alt:u.name,className:"w-full h-full object-cover transition-transform duration-500 hover:scale-105",onError:e=>{const s=u.id.includes("miere")?"/images/AdobeStock_367103665.jpeg":"/images/AdobeStock_370191089.jpeg";e.currentTarget.src=s}})})}),e.jsxs("div",{className:"md:w-1/2 p-8 product-text-container",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2 font-handwriting product-name",children:u.name}),e.jsxs("div",{className:"mb-4 flex items-center",children:[e.jsx("div",{className:"flex product-rating-stars",children:Array.from({length:5}).map(((s,a)=>{var t;return e.jsx("span",{style:{display:"inline-block",fontSize:"1.25rem",marginRight:"2px"},children:a<Math.round((null==(t=u.ratings)?void 0:t.average)||0)?e.jsx(b,{style:{color:"#FFB900"}}):e.jsx(j,{style:{color:"#d1d5db"}})},a)}))}),e.jsx("span",{className:"ml-2 text-gray-600 text-sm",children:(null==(a=u.ratings)?void 0:a.count)?`(${u.ratings.average.toFixed(1)}) ${u.ratings.count} ${1===u.ratings.count?"recenzie":"recenzii"}`:"Fără recenzii încă"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("span",{className:"product-price text-2xl",children:_(u.price)})}),e.jsx("div",{className:"mb-6 product-description",children:e.jsx("p",{className:"leading-relaxed",children:u.description||"Momentan nu există o descriere disponibilă pentru acest produs."})}),u.weight&&e.jsx("div",{className:"mb-4",children:e.jsx("span",{className:"text-sm bg-gray-100 text-gray-800 px-3 py-1 rounded-full",children:u.weight})}),e.jsx("div",{className:"mb-6",children:u.inStock?e.jsx("span",{className:"text-green-600 bg-green-100 px-3 py-1 rounded-full text-sm",children:"În stoc"}):e.jsx("span",{className:"text-red-600 bg-red-100 px-3 py-1 rounded-full text-sm",children:"Stoc epuizat"})}),u.inStock&&e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("label",{htmlFor:"quantity",className:"mr-3 text-gray-700",children:"Cantitate:"}),e.jsx("input",{id:"quantity",type:"number",min:"1",value:f,onChange:e=>{const s=parseInt(e.target.value);s>0&&y(s)},className:"w-16 border border-gray-300 bg-white rounded px-3 py-2 text-center text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("button",{onClick:()=>{u&&(I.current&&I.current.play().catch((e=>{})),F(!0),setTimeout((()=>F(!1)),1500),D({id:u.id,name:u.name,price:u.price,image:u.image,quantity:f}),alert(`${f} x ${u.name} a fost adăugat în coș!`),y(1))},disabled:!u.inStock,className:`w-full py-3 px-4 rounded-lg text-white font-bold \n              ${C?"bg-green-600":"bg-blue-600 hover:bg-blue-700"} \n              transition-all transform ${C?"scale-105":""}`,children:C?"Adăugat în coș!":"Adaugă în coș"})]})]}),e.jsxs("div",{className:"p-8 border-t border-gray-200",children:[u.ingredients&&u.ingredients.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"section-heading text-xl font-bold",children:"Ingrediente"}),e.jsx("ul",{className:"list-disc pl-5 space-y-1 product-description",children:u.ingredients.map(((s,a)=>e.jsx("li",{children:s},a)))})]}),u.story&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"section-heading text-xl font-bold",children:"Povestea din spatele produsului"}),e.jsx("div",{className:"bg-amber-50 p-6 rounded-lg border-l-4 border-amber-200 product-description",children:e.jsx("p",{className:"italic",children:u.story})})]}),u.details&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"section-heading text-xl font-bold",children:"Detalii produs"}),e.jsx("div",{className:"bg-gray-50 p-6 rounded-lg whitespace-pre-line product-description",children:e.jsx("p",{children:u.details})})]})]}),e.jsx("div",{className:"p-8 border-t border-gray-200",children:e.jsx(v,{product:u,currentUser:L?{uid:L.uid,email:L.email||"",displayName:L.displayName||null,photoURL:L.photoURL||null,isAdmin:!1}:null,userHasOrdered:$})}),R.length>0&&e.jsxs("div",{className:"mt-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-center",children:"S-ar putea să-ți placă și"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:R.map((s=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden transform transition hover:scale-105",children:[e.jsx("div",{className:"h-48 overflow-hidden",children:e.jsx("img",{src:s.image||(s.id.includes("miere")?"/images/AdobeStock_367103665.jpeg":"/images/AdobeStock_370191089.jpeg"),alt:s.name,className:"w-full h-full object-cover",onError:e=>{const a=s.id.includes("miere")?"/images/AdobeStock_367103665.jpeg":"/images/AdobeStock_370191089.jpeg";e.currentTarget.src=a}})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-bold text-gray-800",children:s.name}),e.jsx("p",{className:"text-blue-600 font-bold mt-2",children:_(s.price)}),e.jsx(n,{to:`/product/${s.id}`,className:"block mt-3 w-full py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-center",children:"Vezi detalii"})]})]},s.id)))})]})]})]})};export{y as default};
