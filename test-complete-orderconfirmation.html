<!doctype html>
<html lang="ro">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ§ª Test Complete OrderConfirmation cu Date Reale</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        padding: 20px;
      }
      .container {
        background: #f8f9fa;
        padding: 20px;
        margin: 10px 0;
        border-radius: 10px;
      }
      .success {
        background: #d4edda;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
      }
      .btn {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      .btn:hover {
        background: #0056b3;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ§ª Test Complete OrderConfirmation cu Date Reale</h1>

    <div class="container">
      <h3>ğŸ¯ Obiectiv</h3>
      <p>
        TesteazÄƒ dacÄƒ OrderConfirmation recupereazÄƒ È™i afiÈ™eazÄƒ corect datele
        REALE ale clientului.
      </p>
    </div>

    <div class="container">
      <h3>1ï¸âƒ£ PregÄƒtire Date Reale</h3>
      <button class="btn" onclick="setupRealUserData()">
        ğŸ’¾ SalveazÄƒ Date Client Real
      </button>
      <div id="setupResult"></div>
    </div>

    <div class="container">
      <h3>2ï¸âƒ£ Test OrderConfirmation</h3>
      <button class="btn" onclick="openOrderConfirmation()">
        ğŸš€ Deschide OrderConfirmation
      </button>
      <div id="confirmationResult"></div>
    </div>

    <div class="container">
      <h3>3ï¸âƒ£ Verificare Rezultat</h3>
      <button class="btn" onclick="checkResult()">ğŸ” VerificÄƒ Rezultat</button>
      <div id="checkResult"></div>
    </div>

    <script>
      let testOrderId = "LC-REAL-TEST-" + Date.now();

      function setupRealUserData() {
        console.log("ğŸ’¾ Setup Real User Data...");

        // Date REALE client - cum ar veni din formularul de platÄƒ
        const realClientData = {
          orderId: testOrderId,
          amount: "299.99",
          description: "Emblem Premium Gold Package",
          customerInfo: {
            firstName: "Diana",
            lastName: "Marinescu",
            email: "diana.marinescu@yahoo.com", // EMAIL REAL, nu test
            phone: "0734567891",
            address: "Strada Victoriei 123",
            city: "BraÈ™ov",
            county: "BraÈ™ov",
          },
          timestamp: new Date().toISOString(),
          source: "PaymentPage",
        };

        // È˜terge localStorage pentru a forÈ›a recovery din sessionStorage
        localStorage.removeItem("currentOrder");
        localStorage.removeItem("pendingOrder");
        localStorage.removeItem("pendingOrders");

        // SalveazÄƒ Ã®n sessionStorage (ca PaymentPage)
        sessionStorage.setItem(
          "currentOrderBackup",
          JSON.stringify(realClientData)
        );

        console.log("âœ… Date client real salvate Ã®n sessionStorage");
        console.log("ğŸ“‹ OrderID:", testOrderId);
        console.log(
          "ğŸ‘¤ Client:",
          realClientData.customerInfo.firstName,
          realClientData.customerInfo.lastName
        );
        console.log("ğŸ“§ Email REAL:", realClientData.customerInfo.email);

        document.getElementById("setupResult").innerHTML = `
        <div class="success">
            âœ… DATE CLIENT REAL SALVATE!<br>
            ğŸ“‹ OrderID: ${testOrderId}<br>
            ğŸ‘¤ Nume: ${realClientData.customerInfo.firstName} ${realClientData.customerInfo.lastName}<br>
            ğŸ“§ Email: ${realClientData.customerInfo.email}<br>
            ğŸ“± Telefon: ${realClientData.customerInfo.phone}<br>
            ğŸ  AdresÄƒ: ${realClientData.customerInfo.address}, ${realClientData.customerInfo.city}<br>
            ğŸ’° SumÄƒ: ${realClientData.amount} RON<br><br>
            ğŸ’¾ Salvat Ã®n: sessionStorage.currentOrderBackup<br>
            âŒ localStorage: È˜TERS (pentru recovery test)
        </div>
    `;
      }

      function openOrderConfirmation() {
        console.log("ğŸš€ Opening OrderConfirmation...");

        const orderConfirmationUrl = `/order-confirmation?orderId=${testOrderId}`;

        document.getElementById("confirmationResult").innerHTML = `
        <div class="success">
            ğŸš€ DESCHIDERE ORDERCONFIRMATION:<br><br>
            ğŸ“‹ URL: <strong>${orderConfirmationUrl}</strong><br>
            ğŸ†” OrderID: ${testOrderId}<br><br>
            
            ğŸ¯ OrderConfirmation va trebui sÄƒ:<br>
            âœ… Recupereze datele din sessionStorage<br>
            âœ… AfiÈ™eze informaÈ›iile REALE ale clientului<br>
            âœ… TrimitÄƒ emailul la adresa REALÄ‚ a clientului<br><br>
            
            <a href="${orderConfirmationUrl}" target="_blank" style="background: #28a745; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
                ğŸ”— Deschide OrderConfirmation cu date reale
            </a>
        </div>
    `;

        // Auto-deschide dupÄƒ 2 secunde
        setTimeout(() => {
          window.open(orderConfirmationUrl, "_blank");
        }, 2000);
      }

      function checkResult() {
        console.log("ğŸ” Checking result...");

        // VerificÄƒ dacÄƒ datele Ã®ncÄƒ sunt Ã®n sessionStorage
        const sessionBackup = sessionStorage.getItem("currentOrderBackup");

        let resultHtml = "<h4>ğŸ“Š REZULTATE VERIFICARE:</h4>";

        if (sessionBackup) {
          const data = JSON.parse(sessionBackup);
          resultHtml += `
            <div class="success">
                âœ… SessionStorage Ã®ncÄƒ conÈ›ine datele:<br>
                ğŸ‘¤ Nume: ${data.customerInfo.firstName} ${data.customerInfo.lastName}<br>
                ğŸ“§ Email: ${data.customerInfo.email}<br>
                ğŸ†” OrderID: ${data.orderId}
            </div>
        `;

          // VerificÄƒ dacÄƒ emailul este real
          const isRealEmail =
            !data.customerInfo.email.includes("example.com") &&
            !data.customerInfo.email.includes("@test.com") &&
            data.customerInfo.email !== "client.recuperat@example.com";

          if (isRealEmail) {
            resultHtml += `
                <div class="success">
                    ğŸ‰ EMAIL REAL DETECTAT!<br>
                    ğŸ“§ ${data.customerInfo.email} este un email REAL<br>
                    âœ… Clientul va primi emailul de confirmare!
                </div>
            `;
          } else {
            resultHtml += `
                <div class="error">
                    âš ï¸ Email pare sÄƒ fie de test<br>
                    ğŸ“§ ${data.customerInfo.email}
                </div>
            `;
          }
        } else {
          resultHtml += `
            <div class="error">
                âŒ SessionStorage nu mai conÈ›ine datele!<br>
                MoÅ¾da OrderConfirmation le-a procesat È™i È™ters.
            </div>
        `;
        }

        document.getElementById("checkResult").innerHTML = resultHtml;
      }

      // Auto-setup la Ã®ncÄƒrcare
      window.onload = function () {
        console.log("ğŸ§ª Test OrderConfirmation Real Data loaded");

        setTimeout(() => {
          document.getElementById("setupResult").innerHTML = `
            <div style="background: #e2e3e5; padding: 15px; border-radius: 5px;">
                ğŸ¯ PASUL 1: ApasÄƒ "SalveazÄƒ Date Client Real" pentru a pregÄƒti datele<br>
                ğŸ¯ PASUL 2: ApasÄƒ "Deschide OrderConfirmation" pentru a testa recovery<br>
                ğŸ¯ PASUL 3: VerificÄƒ cÄƒ se afiÈ™eazÄƒ datele REALE ale clientului
            </div>
        `;
        }, 500);
      };
    </script>
  </body>
</html>
