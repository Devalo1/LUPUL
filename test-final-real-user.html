<!doctype html>
<html lang="ro">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ¯ Test Final - Date Reale Utilizator</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
        color: white;
      }
      .container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 30px;
        margin: 20px 0;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      h1 {
        color: #ffd700;
        text-align: center;
      }
      h2 {
        color: #90ee90;
        border-bottom: 2px solid #90ee90;
        padding-bottom: 10px;
      }
      .btn {
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        border: none;
        color: white;
        padding: 15px 30px;
        margin: 10px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: bold;
        font-size: 16px;
        transition: all 0.3s ease;
      }
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }
      .result {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        white-space: pre-wrap;
      }
      .success {
        border-left: 4px solid #4caf50;
      }
      .warning {
        border-left: 4px solid #ff9800;
      }
      .info {
        border-left: 4px solid #2196f3;
      }
      .link-btn {
        background: linear-gradient(45deg, #4caf50, #45a049);
        color: white;
        text-decoration: none;
        padding: 12px 25px;
        border-radius: 25px;
        display: inline-block;
        font-weight: bold;
        margin: 10px;
        transition: all 0.3s ease;
      }
      .link-btn:hover {
        background: linear-gradient(45deg, #45a049, #3d8b40);
        transform: translateY(-2px);
      }
    </style>
  </head>
  <body>
    <h1>ğŸ¯ Test Final - Date Reale Utilizator</h1>

    <div class="container">
      <h2>ğŸ“‹ Simulare Flux Complet cu Date Reale</h2>
      <p>
        Acest test simuleazÄƒ exact ce se Ã®ntÃ¢mplÄƒ cÃ¢nd un utilizator real
        completeazÄƒ o comandÄƒ È™i plÄƒteÈ™te cu cardul.
      </p>

      <button class="btn" onclick="setupRealUserData()">
        ğŸ­ Setup Date Client Real
      </button>
      <div id="setupResult" class="result"></div>

      <button class="btn" onclick="clearLocalStorage()">
        ğŸ—‘ï¸ ForÈ›eazÄƒ Pierderea localStorage
      </button>
      <div id="clearResult" class="result"></div>

      <div id="orderConfirmationLink"></div>
    </div>

    <div class="container">
      <h2>ğŸ“Š Verificare Prioritate Recovery</h2>
      <button class="btn" onclick="checkRecoveryPriority()">
        ğŸ” VerificÄƒ Prioritatea Recovery
      </button>
      <div id="priorityResult" class="result"></div>
    </div>

    <script>
      let currentOrderId = null;

      function setupRealUserData() {
        console.log("ğŸ­ Setup date client real...");

        // GenereazÄƒ ID comandÄƒ unic
        currentOrderId = "LC-REAL-CLIENT-" + Date.now();

        // Date REALE ale unui client
        const realUserData = {
          orderId: currentOrderId,
          amount: "199.99",
          description: "Emblem Premium Package",
          customerInfo: {
            firstName: "Alexandra",
            lastName: "Georgescu",
            email: "alexandra.georgescu@gmail.com", // EMAIL REAL!
            phone: "0742567890",
            address: "Bulevardul Unirii 45",
            city: "BucureÈ™ti",
            county: "BucureÈ™ti",
          },
          timestamp: new Date().toISOString(),
          source: "PaymentPage",
        };

        console.log("ğŸ’¾ Salvez date reale Ã®n sessionStorage...");

        // SalveazÄƒ Ã®n sessionStorage (ca PaymentPage modificat)
        sessionStorage.setItem(
          "currentOrderBackup",
          JSON.stringify(realUserData)
        );

        // SimuleazÄƒ cÄƒ localStorage se pierde (È™tergem tot)
        localStorage.removeItem("currentOrder");
        localStorage.removeItem("pendingOrder");
        localStorage.removeItem("pendingOrders");

        let result = `âœ… DATE REALE CLIENT SALVATE!

ğŸ“‹ OrderID: ${currentOrderId}
ğŸ‘¤ Nume: ${realUserData.customerInfo.firstName} ${realUserData.customerInfo.lastName}
ğŸ“§ Email REAL: ${realUserData.customerInfo.email}
ğŸ“± Telefon: ${realUserData.customerInfo.phone}
ğŸ  AdresÄƒ: ${realUserData.customerInfo.address}, ${realUserData.customerInfo.city}
ğŸ’° SumÄƒ: ${realUserData.amount} RON

ğŸ’¾ Salvat Ã®n: sessionStorage.currentOrderBackup
âŒ localStorage: È˜TERS (pentru a forÈ›a recovery)

ğŸ¯ Acum OrderConfirmation va trebui sÄƒ recupereze aceste date REALE!`;

        document.getElementById("setupResult").innerHTML = result;
        document.getElementById("setupResult").className = "result success";

        // AfiÈ™eazÄƒ link-ul cÄƒtre OrderConfirmation
        const linkHtml = `
        <h3>ğŸš€ TesteazÄƒ OrderConfirmation cu Date Reale:</h3>
        <a href="/order-confirmation?orderId=${currentOrderId}" target="_blank" class="link-btn">
            ğŸ”— Deschide OrderConfirmation
        </a>
        <p style="margin-top: 15px;">
            <strong>URL:</strong> /order-confirmation?orderId=${currentOrderId}<br/>
            <strong>Date aÈ™teptate:</strong> Alexandra Georgescu, alexandra.georgescu@gmail.com
        </p>
    `;

        document.getElementById("orderConfirmationLink").innerHTML = linkHtml;
      }

      function clearLocalStorage() {
        // È˜terge complet localStorage pentru a forÈ›a recovery
        localStorage.clear();

        const result = `ğŸ—‘ï¸ LOCALSTORAGE COMPLET È˜TERS!

âŒ Toate datele localStorage au fost È™terse
âœ… sessionStorage pÄƒstrat intact pentru recovery

âš ï¸ Aceasta simuleazÄƒ perfect problema originalÄƒ:
   - localStorage se pierde Ã®ntre PaymentPage È™i OrderConfirmation
   - Utilizatorul nu ar primi email fÄƒrÄƒ recovery system
   
ğŸ¯ Acum recovery system-ul va trebui sÄƒ foloseascÄƒ sessionStorage!`;

        document.getElementById("clearResult").innerHTML = result;
        document.getElementById("clearResult").className = "result warning";
      }

      function checkRecoveryPriority() {
        console.log("ğŸ” Verificare prioritate recovery...");

        let result = "ğŸ” VERIFICARE PRIORITATE RECOVERY:\n\n";

        // 1. VerificÄƒ sessionStorage (PRIORITATE 1)
        const sessionData = sessionStorage.getItem("currentOrderBackup");
        if (sessionData) {
          const data = JSON.parse(sessionData);
          result += "âœ… PRIORITATE 1 - sessionStorage backup: GÄ‚SIT\n";
          result += `   ğŸ“§ Email: ${data.customerInfo.email}\n`;
          result += `   ğŸ‘¤ Nume: ${data.customerInfo.firstName} ${data.customerInfo.lastName}\n`;
          result += `   ğŸ†” OrderID: ${data.orderId}\n\n`;
          result += "ğŸ¯ REZULTAT: OrderConfirmation va folosi DATELE REALE!\n";
          result += "ğŸ“§ Emailul va fi trimis cÄƒtre CLIENTUL REAL!\n";
        } else {
          result += "âŒ PRIORITATE 1 - sessionStorage backup: LIPSÄ‚\n\n";
        }

        // 2. VerificÄƒ localStorage (PRIORITATE 2)
        const localData = localStorage.getItem("currentOrder");
        result += `ğŸ” PRIORITATE 2 - localStorage: ${localData ? "GÄ‚SIT" : "LIPSÄ‚"}\n`;

        const pendingData = localStorage.getItem("pendingOrder");
        result += `ğŸ” PRIORITATE 3 - pendingOrder: ${pendingData ? "GÄ‚SIT" : "LIPSÄ‚"}\n`;

        const pendingOrdersData = localStorage.getItem("pendingOrders");
        result += `ğŸ” PRIORITATE 4 - pendingOrders: ${pendingOrdersData ? "GÄ‚SIT" : "LIPSÄ‚"}\n\n`;

        // Concluzie
        if (sessionData) {
          result += "ğŸ‰ CONCLUZIE: Recovery system va funcÈ›iona perfect!\n";
          result +=
            "âœ… Date reale utilizator vor fi recuperate din sessionStorage\n";
          result += "âœ… Pagina va afiÈ™a informaÈ›ii corecte\n";
          result += "âœ… Emailul va ajunge la clientul real\n";
          document.getElementById("priorityResult").className =
            "result success";
        } else {
          result += "âš ï¸ ATENÈšIE: Nu existÄƒ date Ã®n sessionStorage!\n";
          result += "âŒ RuleazÄƒ primul buton pentru a seta datele\n";
          document.getElementById("priorityResult").className =
            "result warning";
        }

        document.getElementById("priorityResult").innerHTML = result;
      }

      // Auto-check pe load
      window.onload = function () {
        console.log("ğŸ¯ Test Final - Date Reale Utilizator loaded!");

        setTimeout(() => {
          const setupResult = document.getElementById("setupResult");
          setupResult.innerHTML = `ğŸ¯ Ready pentru testarea cu date reale!

ğŸ­ PAÈ˜I PENTRU TEST COMPLET:
   1. ApasÄƒ "Setup Date Client Real" - simuleazÄƒ PaymentPage
   2. ApasÄƒ "ForÈ›eazÄƒ Pierderea localStorage" - simuleazÄƒ problema
   3. ApasÄƒ link-ul pentru OrderConfirmation - testeazÄƒ recovery
   4. VerificÄƒ cÄƒ se afiÈ™eazÄƒ datele REALE ale clientului

ğŸ‰ Recovery system va prioritiza sessionStorage cu date reale!`;
          setupResult.className = "result info";
        }, 500);
      };
    </script>
  </body>
</html>
