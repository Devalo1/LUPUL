<!doctype html>
<html lang="ro">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test OrderConfirmation Fix</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .test-section {
        border: 1px solid #ccc;
        padding: 15px;
        margin: 10px 0;
      }
      .success {
        background-color: #d4edda;
        border-color: #c3e6cb;
      }
      .warning {
        background-color: #fff3cd;
        border-color: #ffeaa7;
      }
      .error {
        background-color: #f8d7da;
        border-color: #f5c6cb;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
        cursor: pointer;
      }
      pre {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <h1>Test OrderConfirmation localStorage Fix</h1>

    <div class="test-section">
      <h2>Pas 1: Simulare Checkout.tsx - Salvare format nou (singular)</h2>
      <p>
        Simulez salvarea unei comenzi Ã®n format nou (cum face Checkout.tsx):
      </p>
      <button onclick="saveNewFormat()">
        SalveazÄƒ ComandÄƒ Format NOU (pendingOrder)
      </button>
      <pre id="newFormatResult"></pre>
    </div>

    <div class="test-section">
      <h2>Pas 2: Simulare Checkout.tsx - Salvare format vechi (plural)</h2>
      <p>
        Simulez salvarea unei comenzi Ã®n format vechi (pentru backward
        compatibility):
      </p>
      <button onclick="saveOldFormat()">
        SalveazÄƒ ComandÄƒ Format VECHI (pendingOrders)
      </button>
      <pre id="oldFormatResult"></pre>
    </div>

    <div class="test-section">
      <h2>Pas 3: Test OrderConfirmation.tsx - Citire cu fix-ul aplicat</h2>
      <p>Testez dacÄƒ OrderConfirmation.tsx poate citi ambele formate:</p>
      <button onclick="testOrderConfirmationFix()">
        TesteazÄƒ Fix-ul OrderConfirmation
      </button>
      <pre id="fixTestResult"></pre>
    </div>

    <div class="test-section">
      <h2>Pas 4: CurÄƒÈ›are teste</h2>
      <button onclick="clearLocalStorage()">CurÄƒÈ›Äƒ localStorage</button>
    </div>

    <div class="test-section">
      <h2>Starea actualÄƒ localStorage:</h2>
      <button onclick="showCurrentLocalStorage()">AfiÈ™eazÄƒ localStorage</button>
      <pre id="localStorageState"></pre>
    </div>

    <script>
      // Simulez exact datele cum le salveazÄƒ Checkout.tsx
      const testOrderData = {
        orderNumber: "LC-1753816908678",
        total: 35,
        customerInfo: {
          firstName: "Dani",
          lastName: "Test",
          email: "dani_popa21@yahoo.ro",
          phone: "0775346243",
        },
        items: [
          {
            name: "Test Product",
            price: 35,
            quantity: 1,
          },
        ],
        paymentMethod: "card",
        timestamp: new Date().toISOString(),
      };

      function saveNewFormat() {
        // Exact cum salveazÄƒ Checkout.tsx
        localStorage.setItem("pendingOrder", JSON.stringify(testOrderData));
        document.getElementById("newFormatResult").textContent =
          "âœ… Salvat Ã®n localStorage['pendingOrder'] (format nou/singular)\n" +
          "Data: " +
          JSON.stringify(testOrderData, null, 2);
      }

      function saveOldFormat() {
        // Format vechi pentru backward compatibility
        const oldFormatData = [testOrderData]; // Array cu o comandÄƒ
        localStorage.setItem("pendingOrders", JSON.stringify(oldFormatData));
        document.getElementById("oldFormatResult").textContent =
          "âœ… Salvat Ã®n localStorage['pendingOrders'] (format vechi/plural)\n" +
          "Data: " +
          JSON.stringify(oldFormatData, null, 2);
      }

      function testOrderConfirmationFix() {
        // Simulez exact logica din OrderConfirmation.tsx dupÄƒ fix
        let foundOrder = null;
        let source = "";

        try {
          // Ãncerc primul format (singular) - formatul nou
          const pendingOrderStr = localStorage.getItem("pendingOrder");
          if (pendingOrderStr) {
            const pendingOrder = JSON.parse(pendingOrderStr);
            if (pendingOrder && pendingOrder.orderNumber) {
              foundOrder = pendingOrder;
              source = "pendingOrder (singular/nou)";
            }
          }

          // DacÄƒ nu am gÄƒsit Ã®n primul format, Ã®ncerc cel vechi (plural)
          if (!foundOrder) {
            const pendingOrdersStr = localStorage.getItem("pendingOrders");
            if (pendingOrdersStr) {
              const pendingOrders = JSON.parse(pendingOrdersStr);
              if (Array.isArray(pendingOrders) && pendingOrders.length > 0) {
                foundOrder = pendingOrders[0]; // Iau prima comandÄƒ
                source = "pendingOrders (plural/vechi)";
              }
            }
          }

          if (foundOrder) {
            const result =
              `âœ… SUCCESS! Fix-ul funcÈ›ioneazÄƒ perfect!\n\n` +
              `ğŸ“ ComandÄƒ gÄƒsitÄƒ Ã®n: localStorage["${source.split(" ")[0]}"]\n` +
              `ğŸ“ SursÄƒ: ${source}\n` +
              `ğŸ”¢ OrderNumber: ${foundOrder.orderNumber}\n` +
              `ğŸ’° Total: ${foundOrder.total} RON\n` +
              `ğŸ“§ Email: ${foundOrder.customerInfo?.email}\n` +
              `â° Timestamp: ${foundOrder.timestamp}\n\n` +
              `Aceasta Ã®nseamnÄƒ cÄƒ OrderConfirmation.tsx va putea:\n` +
              `âœ… SÄƒ afiÈ™eze pagina de confirmare\n` +
              `âœ… SÄƒ trimitÄƒ email-ul de confirmare\n` +
              `âœ… SÄƒ proceseze comanda corect`;

            document.getElementById("fixTestResult").textContent = result;
            document.getElementById("fixTestResult").parentElement.className =
              "test-section success";
          } else {
            document.getElementById("fixTestResult").textContent =
              "âŒ Nu s-a gÄƒsit nicio comandÄƒ Ã®n localStorage.\n" +
              "SalveazÄƒ mai Ã®ntÃ¢i o comandÄƒ cu butoanele de mai sus.";
            document.getElementById("fixTestResult").parentElement.className =
              "test-section error";
          }
        } catch (error) {
          document.getElementById("fixTestResult").textContent =
            `âŒ Eroare la parsarea localStorage: ${error.message}`;
          document.getElementById("fixTestResult").parentElement.className =
            "test-section error";
        }
      }

      function clearLocalStorage() {
        localStorage.removeItem("pendingOrder");
        localStorage.removeItem("pendingOrders");
        showCurrentLocalStorage();

        // Reset test sections
        document.getElementById("newFormatResult").textContent = "";
        document.getElementById("oldFormatResult").textContent = "";
        document.getElementById("fixTestResult").textContent = "";
        document.getElementById("fixTestResult").parentElement.className =
          "test-section";
      }

      function showCurrentLocalStorage() {
        const pendingOrder = localStorage.getItem("pendingOrder");
        const pendingOrders = localStorage.getItem("pendingOrders");

        let result = "ğŸ“‹ Starea actualÄƒ localStorage:\n\n";

        if (pendingOrder) {
          result += `âœ… pendingOrder (singular): ${pendingOrder.substring(0, 100)}...\n\n`;
        } else {
          result += `âŒ pendingOrder (singular): Nu existÄƒ\n\n`;
        }

        if (pendingOrders) {
          result += `âœ… pendingOrders (plural): ${pendingOrders.substring(0, 100)}...\n\n`;
        } else {
          result += `âŒ pendingOrders (plural): Nu existÄƒ\n\n`;
        }

        document.getElementById("localStorageState").textContent = result;
      }

      // AfiÈ™ez starea iniÈ›ialÄƒ
      showCurrentLocalStorage();
    </script>
  </body>
</html>
