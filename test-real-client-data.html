<!doctype html>
<html lang="ro">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ§ª Test Date Reale Ã®n SessionStorage</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }
      .container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 30px;
        margin: 20px 0;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      h1 {
        color: #ffd700;
        text-align: center;
      }
      h2 {
        color: #90ee90;
        border-bottom: 2px solid #90ee90;
        padding-bottom: 10px;
      }
      .btn {
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        border: none;
        color: white;
        padding: 15px 30px;
        margin: 10px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: bold;
        font-size: 16px;
        transition: all 0.3s ease;
      }
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }
      .result {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        white-space: pre-wrap;
      }
      .success {
        border-left: 4px solid #4caf50;
      }
      .error {
        border-left: 4px solid #f44336;
      }
      .info {
        border-left: 4px solid #2196f3;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ§ª Test Date Reale Client Ã®n SessionStorage</h1>

    <div class="container">
      <h2>ğŸ¯ Simulare Date Reale Utilizator</h2>
      <p>
        Acest test simuleazÄƒ datele pe care le-ar salva PaymentPage pentru un
        client real.
      </p>

      <button class="btn" onclick="saveRealUserData()">
        ğŸ’¾ SalveazÄƒ Date Reale Client
      </button>
      <div id="saveResult" class="result"></div>

      <button class="btn" onclick="testOrderConfirmationFlow()">
        ğŸ” Test OrderConfirmation
      </button>
      <div id="testResult" class="result"></div>

      <button class="btn" onclick="openOrderConfirmation()">
        ğŸš€ Deschide OrderConfirmation
      </button>
      <div id="openResult" class="result"></div>
    </div>

    <div class="container">
      <h2>ğŸ“Š Status SessionStorage</h2>
      <button class="btn" onclick="checkSessionStorage()">
        ğŸ” VerificÄƒ SessionStorage
      </button>
      <div id="storageResult" class="result"></div>
    </div>

    <script>
      const REAL_ORDER_ID = "LC-REAL-CLIENT-" + Date.now();

      function saveRealUserData() {
        console.log("ğŸ’¾ Salvez date REALE de client...");

        // Date reale de client (ca Ã®n PaymentPage)
        const realClientData = {
          orderId: REAL_ORDER_ID,
          amount: "199.99",
          description: "Emblem Premium Gold - ComandÄƒ RealÄƒ",
          customerInfo: {
            firstName: "Alexandra",
            lastName: "Georgescu",
            email: "alexandra.georgescu@gmail.com", // EMAIL REAL!
            phone: "0742567890",
            address: "Bulevardul Unirii 45",
            city: "BucureÈ™ti",
            county: "BucureÈ™ti",
          },
          timestamp: new Date().toISOString(),
          source: "PaymentPage",
        };

        // SalveazÄƒ Ã®n sessionStorage (exact ca PaymentPage)
        sessionStorage.setItem(
          "currentOrderBackup",
          JSON.stringify(realClientData)
        );

        // È˜terge localStorage pentru a forÈ›a recovery
        localStorage.removeItem("currentOrder");
        localStorage.removeItem("pendingOrder");
        localStorage.removeItem("pendingOrders");

        document.getElementById("saveResult").innerHTML = `
âœ… DATE REALE CLIENT SALVATE!

ğŸ“‹ OrderID: ${REAL_ORDER_ID}
ğŸ‘¤ Nume: ${realClientData.customerInfo.firstName} ${realClientData.customerInfo.lastName}
ğŸ“§ Email REAL: ${realClientData.customerInfo.email}
ğŸ“± Telefon: ${realClientData.customerInfo.phone}
ğŸ  AdresÄƒ: ${realClientData.customerInfo.address}, ${realClientData.customerInfo.city}
ğŸ’° SumÄƒ: ${realClientData.amount} RON

ğŸ’¾ Salvat Ã®n: sessionStorage.currentOrderBackup
âŒ localStorage: È˜TERS (pentru a forÈ›a recovery)

ğŸ¯ Acum OrderConfirmation va trebui sÄƒ recupereze aceste date REALE!
`;
        document.getElementById("saveResult").className = "result success";
      }

      function testOrderConfirmationFlow() {
        console.log("ğŸ” Testez fluxul OrderConfirmation...");

        const result = document.getElementById("testResult");
        result.innerHTML = "ğŸ” Se testeazÄƒ fluxul de recovery...";

        // SimuleazÄƒ logica din OrderConfirmation
        let foundOrderData = null;

        // 1. VerificÄƒ localStorage (va fi gol)
        const currentOrderData = localStorage.getItem("currentOrder");
        if (currentOrderData) {
          foundOrderData = JSON.parse(currentOrderData);
          console.log("âœ… Date gÄƒsite Ã®n localStorage");
        } else {
          console.log("âŒ localStorage.currentOrder: LIPSÄ‚");
        }

        // 2. VerificÄƒ sessionStorage backup (aici sunt datele reale!)
        if (!foundOrderData) {
          const backupDataStr = sessionStorage.getItem("currentOrderBackup");
          if (backupDataStr) {
            try {
              const backupData = JSON.parse(backupDataStr);
              console.log(
                "ğŸ“¦ Date backup gÄƒsite Ã®n sessionStorage:",
                backupData
              );

              // TransformÄƒ Ã®n formatul pentru OrderConfirmation
              foundOrderData = {
                orderNumber: backupData.orderId,
                customerName: `${backupData.customerInfo.firstName} ${backupData.customerInfo.lastName}`,
                customerEmail: backupData.customerInfo.email,
                customerPhone: backupData.customerInfo.phone,
                customerAddress: backupData.customerInfo.address,
                customerCity: backupData.customerInfo.city,
                customerCounty: backupData.customerInfo.county,
                totalAmount: backupData.amount,
                paymentMethod: "Card bancar (NETOPIA Payments)",
                date: backupData.timestamp,
                items: [
                  {
                    name: backupData.description,
                    price: backupData.amount,
                    quantity: 1,
                  },
                ],
                isRealUserData: true,
              };

              console.log("âœ… Date REALE recuperate din sessionStorage");
            } catch (error) {
              console.error("âŒ Eroare parsare backup:", error);
            }
          }
        }

        let resultText = "ğŸ” SIMULARE FLUX ORDERCONFIRMATION:\n\n";

        if (foundOrderData) {
          resultText += "âœ… RECOVERY SUCCESSFUL!\n\n";
          resultText += `ğŸ“‹ OrderID: ${foundOrderData.orderNumber}\n`;
          resultText += `ğŸ‘¤ Nume: ${foundOrderData.customerName}\n`;
          resultText += `ğŸ“§ Email: ${foundOrderData.customerEmail}\n`;
          resultText += `ğŸ“± Telefon: ${foundOrderData.customerPhone}\n`;
          resultText += `ğŸ  AdresÄƒ: ${foundOrderData.customerAddress}, ${foundOrderData.customerCity}\n`;
          resultText += `ğŸ’° Total: ${foundOrderData.totalAmount} RON\n`;
          resultText += `ğŸ·ï¸ Date reale: ${foundOrderData.isRealUserData ? "DA" : "NU"}\n\n`;

          if (
            foundOrderData.isRealUserData &&
            foundOrderData.customerEmail.includes("@gmail.com")
          ) {
            resultText +=
              "ğŸ‰ PERFECT! Acestea sunt datele REALE ale clientului!\n";
            resultText += "âœ… Emailul va fi trimis cÄƒtre clientul real!\n";
            resultText += "âœ… Pagina va afiÈ™a informaÈ›iile corecte!\n";
            result.className = "result success";
          } else {
            resultText += "âš ï¸ Date gÄƒsite, dar nu sunt date reale de client\n";
            result.className = "result error";
          }
        } else {
          resultText += "âŒ NU S-AU GÄ‚SIT DATE!\n";
          resultText += "âŒ Recovery a eÈ™uat complet\n";
          result.className = "result error";
        }

        result.innerHTML = resultText;
      }

      function openOrderConfirmation() {
        const backupData = sessionStorage.getItem("currentOrderBackup");
        if (!backupData) {
          document.getElementById("openResult").innerHTML =
            "âŒ Nu existÄƒ date Ã®n sessionStorage! ApasÄƒ mai Ã®ntÃ¢i 'SalveazÄƒ Date Reale Client'";
          document.getElementById("openResult").className = "result error";
          return;
        }

        const data = JSON.parse(backupData);
        const url = `/order-confirmation?orderId=${data.orderId}`;

        document.getElementById("openResult").innerHTML = `
ğŸš€ DESCHIDE ORDERCONFIRMATION CU DATE REALE:

ğŸ“‹ URL: ${url}
ğŸ‘¤ Client: ${data.customerInfo.firstName} ${data.customerInfo.lastName}
ğŸ“§ Email: ${data.customerInfo.email}

ğŸ¯ OrderConfirmation va trebui sÄƒ:
   âœ… Recupereze datele din sessionStorage
   âœ… AfiÈ™eze informaÈ›iile REALE ale clientului
   âœ… TrimitÄƒ emailul la adresa REALÄ‚ a clientului
   
ğŸ”— ApasÄƒ link-ul de mai jos pentru a testa:
`;

        // CreeazÄƒ link pentru testare
        const link = document.createElement("a");
        link.href = url;
        link.textContent = "ğŸ”— Deschide OrderConfirmation cu date reale";
        link.style.cssText =
          "display: block; color: #FFD700; font-weight: bold; margin: 10px 0; text-decoration: underline;";
        link.target = "_blank";

        const resultDiv = document.getElementById("openResult");
        resultDiv.appendChild(link);
        resultDiv.className = "result info";
      }

      function checkSessionStorage() {
        let status = "ğŸ“Š STATUS SESSIONSTORAGE:\n\n";

        const backup = sessionStorage.getItem("currentOrderBackup");
        if (backup) {
          try {
            const data = JSON.parse(backup);
            status += "âœ… currentOrderBackup: EXISTÄ‚\n\n";
            status += "ğŸ“‹ Date salvate:\n";
            status += `   OrderID: ${data.orderId}\n`;
            status += `   Nume: ${data.customerInfo.firstName} ${data.customerInfo.lastName}\n`;
            status += `   Email: ${data.customerInfo.email}\n`;
            status += `   Telefon: ${data.customerInfo.phone}\n`;
            status += `   AdresÄƒ: ${data.customerInfo.address}\n`;
            status += `   OraÈ™: ${data.customerInfo.city}\n`;
            status += `   SumÄƒ: ${data.amount} RON\n`;
            status += `   Timestamp: ${data.timestamp}\n`;

            document.getElementById("storageResult").className =
              "result success";
          } catch (error) {
            status += "âŒ currentOrderBackup: CORUPT\n";
            status += `âŒ Error: ${error.message}\n`;
            document.getElementById("storageResult").className = "result error";
          }
        } else {
          status += "âŒ currentOrderBackup: LIPSÄ‚\n";
          status += "âš ï¸ Nu existÄƒ date Ã®n sessionStorage\n";
          document.getElementById("storageResult").className = "result error";
        }

        document.getElementById("storageResult").innerHTML = status;
      }

      // Auto-check la Ã®ncÄƒrcare
      window.onload = function () {
        console.log("ğŸ§ª Test Date Reale Client loaded!");
        checkSessionStorage();
      };
    </script>
  </body>
</html>
