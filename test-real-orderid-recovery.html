<!doctype html>
<html lang="ro">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Real OrderID Data Recovery</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .test-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      .results {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin-top: 10px;
        white-space: pre-wrap;
        font-family: monospace;
        font-size: 12px;
        max-height: 400px;
        overflow-y: auto;
      }
      .success {
        color: #28a745;
      }
      .warning {
        color: #ffc107;
      }
      .error {
        color: #dc3545;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>ğŸ” Test Real OrderID Data Recovery</h1>
      <p>
        Testez recuperarea datelor reale pentru OrderID:
        <strong>LC-1753825745688</strong>
      </p>

      <button onclick="injectRealOrderData()">
        1. ğŸ’‰ Inject Date Reale pentru LC-1753825745688
      </button>
      <button onclick="testOrderRecovery()">
        2. ğŸ”„ Test OrderConfirmation cu Date Reale
      </button>
      <button onclick="checkStorageData()">
        3. ğŸ“‹ VerificÄƒ Date Ã®n Storage
      </button>
      <button onclick="clearAll()">4. ğŸ§¹ CurÄƒÈ›Äƒ Tot</button>

      <div id="results" class="results"></div>
    </div>

    <script>
      const realOrderId = "LC-1753825745688"; // OrderID real din log-uri

      function log(message, type = "info") {
        const results = document.getElementById("results");
        const timestamp = new Date().toLocaleTimeString();
        const colors = {
          info: "#000",
          success: "#28a745",
          warning: "#ffc107",
          error: "#dc3545",
        };

        results.innerHTML += `<span style="color: ${colors[type]}">[${timestamp}] ${message}</span>\n`;
        results.scrollTop = results.scrollHeight;
      }

      function injectRealOrderData() {
        log("ğŸ’‰ Inject-Ã¢nd date REALE pentru OrderID: " + realOrderId, "info");

        // DATELE REALE ALE UTILIZATORULUI pentru comanda actualÄƒ
        const realOrderData = {
          orderId: realOrderId, // IMPORTANT: OrderID-ul real din platÄƒ
          customerInfo: {
            firstName: "Dani_popa21",
            lastName: "Lupul",
            email: "dani_popa21@yahoo.ro", // EMAIL REAL
            phone: "0775346243",
            address: "9 MAI BLOC 2 A",
            city: "PETROSANI",
            county: "HUNEDOARA",
          },
          amount: 35, // SUMA REALÄ‚ din platÄƒ
          description: "ComandÄƒ Lupul È™i Corbul - 1 produse (35.00 RON)",
          timestamp: new Date().toISOString(),
        };

        // SalveazÄƒ Ã®n sessionStorage (prioritate MAXIMÄ‚)
        sessionStorage.setItem(
          "currentOrderBackup",
          JSON.stringify(realOrderData)
        );
        log(
          "âœ… Date reale salvate Ã®n sessionStorage pentru: " + realOrderId,
          "success"
        );

        // SalveazÄƒ È™i Ã®n localStorage ca backup
        const pendingOrders = {};
        pendingOrders[realOrderId] = {
          orderNumber: realOrderId,
          customerName: "Dani_popa21 Lupul",
          customerEmail: "dani_popa21@yahoo.ro", // EMAIL REAL
          customerPhone: "0775346243",
          customerAddress: "9 MAI BLOC 2 A",
          customerCity: "PETROSANI",
          customerCounty: "HUNEDOARA",
          totalAmount: 35,
          paymentMethod: "Card bancar (NETOPIA Payments)",
          date: new Date().toISOString(),
          items: [
            {
              name: "ComandÄƒ Lupul È™i Corbul - 1 produse",
              price: 35,
              quantity: 1,
            },
          ],
          isRealUserData: true, // IMPORTANT: MarcheazÄƒ ca date reale
        };

        localStorage.setItem("pendingOrders", JSON.stringify(pendingOrders));
        log("âœ… Date backup salvate Ã®n localStorage", "success");
        log("ğŸ“§ Email REAL utilizator: dani_popa21@yahoo.ro", "success");
      }

      function testOrderRecovery() {
        log("ğŸ”„ Testez OrderConfirmation cu date reale...", "info");

        const orderConfirmationUrl = `http://localhost:8888/order-confirmation?orderId=${realOrderId}&status=paid`;

        log(
          "ğŸŒ Deschid OrderConfirmation cu date reale: " + orderConfirmationUrl,
          "info"
        );

        const newWindow = window.open(
          orderConfirmationUrl,
          "_blank",
          "width=800,height=600"
        );

        if (newWindow) {
          log("âœ… OrderConfirmation deschis cu date REALE", "success");
          log("ğŸ‘€ ACUM ar trebui sÄƒ vezi:", "warning");
          log("- Nume: Dani_popa21 Lupul", "warning");
          log("- Email: dani_popa21@yahoo.ro", "warning");
          log("- Telefon: 0775346243", "warning");
          log("- Adresa: 9 MAI BLOC 2 A, PETROSANI, HUNEDOARA", "warning");
          log("- Total: 35.00 RON", "warning");
          log("ğŸ“§ Emailul ar trebui trimis cÄƒtre CLIENT REAL!", "success");
        } else {
          log("âŒ Nu s-a putut deschide fereastra nouÄƒ", "error");
        }
      }

      function checkStorageData() {
        log("ğŸ“‹ VerificÃ¢nd datele din storage...", "info");

        // VerificÄƒ sessionStorage
        const sessionData = sessionStorage.getItem("currentOrderBackup");
        if (sessionData) {
          try {
            const parsed = JSON.parse(sessionData);
            log(
              "âœ… SessionStorage gÄƒsit pentru OrderID: " + parsed.orderId,
              "success"
            );
            log(
              "ğŸ“§ Email Ã®n sessionStorage: " + parsed.customerInfo.email,
              "success"
            );
            log(
              "ğŸ‘¤ Nume Ã®n sessionStorage: " +
                parsed.customerInfo.firstName +
                " " +
                parsed.customerInfo.lastName,
              "success"
            );
          } catch (e) {
            log("âŒ Eroare la parsarea sessionStorage: " + e.message, "error");
          }
        } else {
          log("âŒ Nu existÄƒ date Ã®n sessionStorage", "error");
        }

        // VerificÄƒ localStorage
        const localData = localStorage.getItem("pendingOrders");
        if (localData) {
          try {
            const parsed = JSON.parse(localData);
            if (parsed[realOrderId]) {
              log(
                "âœ… LocalStorage gÄƒsit pentru OrderID: " + realOrderId,
                "success"
              );
              log(
                "ğŸ“§ Email Ã®n localStorage: " +
                  parsed[realOrderId].customerEmail,
                "success"
              );
              log(
                "ğŸ·ï¸ isRealUserData: " + parsed[realOrderId].isRealUserData,
                "success"
              );
            } else {
              log(
                "âŒ Nu existÄƒ OrderID Ã®n localStorage: " + realOrderId,
                "error"
              );
            }
          } catch (e) {
            log("âŒ Eroare la parsarea localStorage: " + e.message, "error");
          }
        } else {
          log("âŒ Nu existÄƒ pendingOrders Ã®n localStorage", "error");
        }
      }

      function clearAll() {
        sessionStorage.clear();
        localStorage.clear();
        document.getElementById("results").innerHTML = "";
        log("ğŸ§¹ Tot storage-ul a fost curÄƒÈ›at", "success");
      }

      // Auto-setup la Ã®ncÄƒrcare
      window.onload = function () {
        log("ğŸ” Test Real OrderID Data Recovery iniÈ›ializat", "success");
        log("ğŸ¯ Target OrderID: " + realOrderId, "info");
        log("ğŸ“ PaÈ™i:", "info");
        log("1. Inject date reale pentru OrderID-ul actual", "info");
        log("2. TesteazÄƒ OrderConfirmation cu datele reale", "info");
        log(
          "3. VerificÄƒ cÄƒ se afiÈ™eazÄƒ datele corecte ale utilizatorului",
          "info"
        );
      };
    </script>
  </body>
</html>
